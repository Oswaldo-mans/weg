<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROYECTO - GANTT</title>
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <link rel="stylesheet" href="Menu2.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gantt_grid_data .gantt_cell:nth-child(2),
        .gantt_grid_data .gantt_cell:nth-child(5),
        .gantt_grid_data .gantt_cell:nth-child(9),
        .gantt_grid_data .gantt_cell:nth-child(10) {
            border-right: 2px solid #e7e3e3;
        }
        .client-name {
        font-size: 1em; /*TAMAÑO*/
        }
    </style>
</head>
<body>
    <!-- NOMBRE DE LA PAGINA -->
    <div id="Titulo" class="g-container">
        <h1>CLIENTE: <span id="clientName" class="client-name"></span></h1>
    </div>

    <!-- MENU INTERACTIVO -->
    <div id="MenuG" class="s-container">
        <div class="ganttM">
            <ul>
                <li id="menu-gantt" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-chart-gantt"></i>
                        <span>Gantt</span>
                    </a>
                </li>
                <li id="Kanba" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-users"></i>
                        <span>Panel</span>
                    </a>
                </li>
                <li id="Graficos" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-chart-pie"></i>
                        <span>Graficos</span>
                    </a>
                </li>
                <li id="Reportes" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-file"></i>
                        <span>Reportes</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div id="gantt_chart" style="width: 217vh; height: 85vh;"></div>
    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const clientName = urlParams.get('clientName');
            const totalItems = parseInt(urlParams.get('totalItems'));
            const clientOrder = urlParams.get('clientOrder');
            const options = JSON.parse(urlParams.get('options'));
            const idItems = JSON.parse(urlParams.get('idItems'));
            const idColumna = JSON.parse(urlParams.get('idColumna'));
            const difficulty = JSON.parse(urlParams.get('difficulty'));
            const date = JSON.parse(urlParams.get('date'));
            const dateF = JSON.parse(urlParams.get('dateF'));

            document.getElementById('clientName').textContent = clientName;

            // Initialize or retrieve stored durations
            const storedDurations = JSON.parse(localStorage.getItem('taskDurations')) || {};

            gantt.config.xml_date = "%Y-%m-%d %H:%i";
            gantt.config.lightbox.sections = [
                { name: "description", height: 70, map_to: "text", type: "textarea", focus: true },
                { name: "time", height: 72, type: "duration", map_to: "auto" },
                { name: "responsible", height: 20, map_to: "responsible", type: "select", options: [
                    { key: "INGENIERIA", label: "INGENIERIA" },
                    { key: "COMPRAS", label: "COMPRAS" },
                    { key: "PCP", label: "PCP" },
                    { key: "AREA", label: "AREA" }
                ] }
            ];
            gantt.locale.labels.section_description = "Tarea";
            gantt.locale.labels.section_time = "Duración";
            gantt.locale.labels.section_responsible = "Responsable";

            gantt.config.columns = gantt.config.columns.map(column => {
                switch (column.name) {
                    case "text":
                        return { name: "text", label: "ACTIVIDAD", tree: true, width: 300 };
                    case "start_date":
                        return { name: "start_date", label: "INICIO/REAL", align: "center", width: 72 };
                    case "duration":
                        return { name: "duration", label: "DURACIÓN", align: "center", width: 53 };
                    default:
                        return column;
                }
            });

            gantt.config.columns.unshift(
                { name: "checklist", label: "☑_☑", width: 25, template: function(task) {
                    return '<input type="checkbox" class="task-checkbox" data-task-id="' + task.id + '">';
                }}
            );

            gantt.config.columns.push(
                { name: "new_start_date", label: "INICIO/IDEAL", align: "center", width: 72, template: function(task) {
                    if (task.original_new_start_date) {
                        return gantt.templates.date_grid(task.original_new_start_date);
                    }
                    const NewStartDate = gantt.date.add(task.start_date, 0, "day");
                    task.original_new_start_date = NewStartDate;
                    return gantt.templates.date_grid(NewStartDate);
                }}
            );

            gantt.config.columns.splice(2, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "new_end_date", label: "FIN/IDEAL", align: "center", width: 72, template: function(task) {
                    if (task.original_new_end_date) {
                        return gantt.templates.date_grid(task.original_new_end_date);
                    }
                    const NewendDate = gantt.calculateEndDate(gantt.calculateEndDate(task.start_date, task.duration - 1));
                    task.original_new_end_date = NewendDate;
                    return gantt.templates.date_grid(NewendDate);
                }}
            );

            gantt.config.columns.splice(3, 0, gantt.config.columns.pop());

            gantt.attachEvent("onTaskCreated", function(task) {
                task.originalStartDate = task.start_date;
                task.originalEndDate = task.end_date;
                return true;
            });

            gantt.attachEvent("onAfterTaskUpdate", function(id, task) {
                if (!task.originalStartDate) {
                    task.originalStartDate = task.start_date;
                }
                if (!task.originalEndDate) {
                    task.originalEndDate = task.end_date;
                }
                return true;
            });
            gantt.config.columns.push({
            name: "establecido",
            label: "IDEAL",
            align: "center",
            width: 60,
            template: function(task) {
                if (task.hasOwnProperty('idealProgress')) {
                    return task.idealProgress + '%';
                }
                const taskDurations = [1, 3, 5, 2, 3, 3, 6, 2, 4, 4, 1, 2, 1, 1, 3];
                // Duración específica para el cálculo de la columna "establecido"
                const fixedDurations = {
                    "Aceptación de proyecto": 1,
                    "Documentos para aprobación": 3,
                    "Aprobación - cliente": 5,
                    "Liberación - RIPA": 2,
                    "Analizar RIPA": 3,
                    "Reporte de fecha RIPA": 3,
                    "Liberación - lista": 6,
                    "Liberación de WORKFLOW": 2,
                    "Analizar lista": 4,
                    "Reporte de fecha - lista": 4,
                    "Documentos para fabricación": 1,
                    "Asignación de rutas": 2,
                    "Fabricación": 1,
                    "Reporte de pruebas FAT": 1,
                    "Reporte de pruebas (Rutina o Dossier)": 3
                };

                // Porcentajes específicos para el cálculo de la columna "establecido"
                const taskPercentages = {
                    "Aceptación de proyecto": 1,
                    "Documentos para aprobación": 5,
                    "Aprobación - cliente": 2,
                    "Liberación - RIPA": 4,
                    "Analizar RIPA": 1,
                    "Reporte de fecha RIPA": 10,
                    "Liberación - lista": 16,
                    "Liberación de WORKFLOW": 1,
                    "Analizar lista": 1,
                    "Reporte de fecha - lista": 20,
                    "Documentos para fabricación": 6,
                    "Asignación de rutas": 1,
                    "Fabricación": 30,
                    "Reporte de pruebas FAT": 1,
                    "Reporte de pruebas (Rutina o Dossier)": 1
                };

                if (task.$level === 0) {
                    const subtasks = gantt.getChildren(task.id);
                    let totalProgress = 0;

                    subtasks.forEach(subtaskId => {
                        const subtask = gantt.getTask(subtaskId);
                        const today = new Date();
                        const hour = today.getHours();

                        if (hour < 8) {
                            today.setDate(today.getDate() - 1);
                        }

                        const elapsedRealHours = calculateTotalHours(subtask.start_date, today);
                        const duration = fixedDurations[subtask.text.split(".- ")[1]] || 0;
                        const taskPercentage = taskPercentages[subtask.text.split(".- ")[1]] || 100;

                        const progressPercentage = (elapsedRealHours / (duration * 24)) * taskPercentage;
                        totalProgress += Math.min(progressPercentage, taskPercentage);
                    });
                    task.idealProgress = totalProgress.toFixed(2);
                    return task.idealProgress + '%';
                } else {
                    const today = new Date();
                    const hour = today.getHours();

                    if (hour < 8) {
                        today.setDate(today.getDate() - 1);
                    }

                    const elapsedRealHours = calculateTotalHours(task.start_date, today);
                    const duration = fixedDurations[task.text.split(".- ")[1]] || 0;
                    const taskPercentage = taskPercentages[task.text.split(".- ")[1]] || 100;

                    const progressPercentage = (elapsedRealHours / (duration * 24)) * taskPercentage;
                    task.idealProgress = Math.min(progressPercentage, taskPercentage).toFixed(2);
                    return task.idealProgress + '%';
                }
            }
        });
            gantt.config.columns.splice(4, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "end_date", label: "FIN/REAL", align: "center", width: 80, template: function(task) {
                    const endDate = gantt.calculateEndDate(task.start_date, task.duration);
                    endDate.setDate(endDate.getDate() - 1);

                    if (endDate.getDay() === 0) {
                        endDate.setDate(endDate.getDate() - 2);
                    }

                    return gantt.templates.date_grid(endDate);
                }}
            );
            gantt.config.columns.splice(7, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "real", label: "REAL", align: "center", width: 60, template: function(task) {
                    if (task.$level === 0) {
                        const subtasks = gantt.getChildren(task.id);
                        let totalProgress = 0;

                        subtasks.forEach(subtaskId => {
                            const subtask = gantt.getTask(subtaskId);
                            const startDate = subtask.start_date;
                            const endDate = new Date(subtask.end_date);
                            endDate.setDate(endDate.getDate() - 1);

                            const today = new Date();
                            const hour = today.getHours();

                            if (hour < 17) {
                                today.setDate(today.getDate() - 1);
                            }

                            const totalRealHours = calculateTotalHours(startDate, endDate);
                            const elapsedRealHours = calculateTotalHours(startDate, today);

                            let taskPercentage = 100;
                            if (subtask.text.includes("Aceptación de proyecto")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Documentos para aprobación")) {
                                taskPercentage = 5;
                            } else if (subtask.text.includes("Aprobación - cliente")) {
                                taskPercentage = 2;
                            } else if (subtask.text.includes("Liberación - RIPA")) {
                                taskPercentage = 4;
                            } else if (subtask.text.includes("Analizar RIPA")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de fecha RIPA")) {
                                taskPercentage = 10;
                            } else if (subtask.text.includes("Liberación - lista")) {
                                taskPercentage = 16;
                            } else if (subtask.text.includes("Liberación de WORKFLOW")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Analizar lista")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de fecha - lista")) {
                                taskPercentage = 20;
                            } else if (subtask.text.includes("Documentos para fabricación")) {
                                taskPercentage = 6;
                            } else if (subtask.text.includes("Asignación de rutas")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Fabricación")) {
                                taskPercentage = 30;
                            } else if (subtask.text.includes("Reporte de pruebas FAT")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de pruebas (Rutina o Dossier)")) {
                                taskPercentage = 1;
                            }

                            const progressPercentage = (elapsedRealHours / totalRealHours) * taskPercentage;
                            totalProgress += Math.min(progressPercentage, taskPercentage);
                        });

                        return totalProgress.toFixed(2) + '%';
                    } else {
                        const startDate = task.start_date;
                        const endDate = new Date(task.end_date);
                        endDate.setDate(endDate.getDate() - 1);

                        const today = new Date();
                        const hour = today.getHours();

                        if (hour < 17) {
                            today.setDate(today.getDate() - 1);
                        }

                        const totalRealHours = calculateTotalHours(startDate, endDate);
                        const elapsedRealHours = calculateTotalHours(startDate, today);

                        let taskPercentage = 100;
                        if (task.text.includes("Aceptación de proyecto")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Documentos para aprobación")) {
                            taskPercentage = 5;
                        } else if (task.text.includes("Aprobación - cliente")) {
                            taskPercentage = 2;
                        } else if (task.text.includes("Liberación - RIPA")) {
                            taskPercentage = 4;
                        } else if (task.text.includes("Analizar RIPA")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de fecha RIPA")) {
                            taskPercentage = 10;
                        } else if (task.text.includes("Liberación - lista")) {
                            taskPercentage = 16;
                        } else if (task.text.includes("Liberación de WORKFLOW")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Analizar lista")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de fecha - lista")) {
                            taskPercentage = 20;
                        } else if (task.text.includes("Documentos para fabricación")) {
                            taskPercentage = 6;
                        } else if (task.text.includes("Asignación de rutas")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Fabricación")) {
                            taskPercentage = 30;
                        } else if (task.text.includes("Reporte de pruebas FAT")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de pruebas (Rutina o Dossier)")) {
                            taskPercentage = 1;
                        }

                        const progressPercentage = (elapsedRealHours / totalRealHours) * taskPercentage;
                        return Math.min(progressPercentage, taskPercentage).toFixed(2) + '%';
                    }
                }}
            );
            gantt.config.columns.splice(8, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "responsible", label: "RESPONSABLE", align: "center", width: 85, template: function(task) {
                    return task.responsible || "";
                }}
            );
            gantt.config.columns.splice(9, 0, gantt.config.columns.pop());

            const taskNameColumn = gantt.config.columns.find(column => column.name === "text");
            taskNameColumn.width = 300;

            const taskResponsibles = {
                INGENIERIA: ["Fermin Flores", "Antonio"],
                COMPRAS: ["Orbelin", "Cinthya", "Saul", "Ariana", "Daniela"],
                PCP: ["Janet"],
                PROCESOS: ["Erik"],
                AREA: ["Fermin Flores", "Antonio", "Orbelin", "Cinthya", "Saul", "Ariana", "Daniela", "Janet", "Erik"]
            };

            function calculateEndDateWithoutWeekends(startDate, duration) {
                let current = new Date(startDate);
                let daysAdded = 0;
                while (daysAdded < duration) {
                    current.setDate(current.getDate() + 1);
                    if (current.getDay() !== 0 && current.getDay() !== 6) {
                        daysAdded++;
                    }
                }
                return current;
            }

            function adjustDateForWeekends(date, isIncreasing) {
                if (isIncreasing) {
                    while (date.getDay() === 0 || date.getDay() === 6) {
                        date.setDate(date.getDate() + 1);
                    }
                } else {
                    while (date.getDay() === 0 || date.getDay() === 6) {
                        date.setDate(date.getDate() - 1);
                    }
                }
                return date;
            }

            function calculateTotalHours(startDate, endDate) {
                let totalHours = 0;
                const current = new Date(startDate);

                while (current <= endDate) {
                    if (current.getDay() !== 0 && current.getDay() !== 6) {
                        totalHours += 24;
                    }
                    current.setDate(current.getDate() + 1);
                }

                return totalHours;
            }

            const data = [];
            for (let i = 0; i < totalItems; i++) {
                const taskName = "Tablero " + (i + 1) + ": " + options[i];
                const idItem = idItems[i];

                const subTaskName1 = idItem + ".- Aceptación de proyecto";
                const subTaskName2 = idItem + ".- Documentos para aprobación";
                const subTaskName3 = idItem + ".- Aprobación - cliente";
                const subTaskName4 = idItem + ".- Liberación - RIPA";
                const subTaskName5 = idItem + ".- Analizar RIPA";
                const subTaskName6 = idItem + ".- Reporte de fecha RIPA";
                const subTaskName7 = idItem + ".- Liberación - lista";
                const subTaskName8 = idItem + ".- Liberación de WORKFLOW";
                const subTaskName9 = idItem + ".- Analizar lista";
                const subTaskName10 = idItem + ".- Reporte de fecha - lista";
                const subTaskName11 = idItem + ".- Documentos para fabricación";
                const subTaskName12 = idItem + ".- Asignación de rutas";
                const subTaskName13 = idItem + ".- Fabricación";
                const subTaskName14 = idItem + ".- Reporte de pruebas FAT";
                const subTaskName15 = idItem + ".- Reporte de pruebas (Rutina o Dossier)";

                const startDate = calculateEndDateWithoutWeekends(new Date(date[i]), 1);                        
                const EndDate = calculateEndDateWithoutWeekends(new Date(dateF[i]), 2);

                const AEndDate = calculateEndDateWithoutWeekends(startDate, storedDurations[subTaskName1] || 1); // Aceptación de proyecto
                const BEndDate = calculateEndDateWithoutWeekends(AEndDate, storedDurations[subTaskName2] || 3);
                const CEndDate = calculateEndDateWithoutWeekends(BEndDate, storedDurations[subTaskName3] || 5);
                const DEndDate = calculateEndDateWithoutWeekends(CEndDate, storedDurations[subTaskName4] || 2);
                const EEndDate = calculateEndDateWithoutWeekends(DEndDate, storedDurations[subTaskName5] || 3);
                const FEndDate = calculateEndDateWithoutWeekends(EEndDate, storedDurations[subTaskName6] || 3);
                const GEndDate = calculateEndDateWithoutWeekends(FEndDate, storedDurations[subTaskName7] || 6); // Liberación - lista
                const HEndDate = calculateEndDateWithoutWeekends(GEndDate, storedDurations[subTaskName8] || 2);
                const IEndDate = calculateEndDateWithoutWeekends(HEndDate, storedDurations[subTaskName9] || 4); 
                const JEndDate = calculateEndDateWithoutWeekends(IEndDate, storedDurations[subTaskName10] || 4);
                const KEndDate = calculateEndDateWithoutWeekends(JEndDate, storedDurations[subTaskName11] || 1);
                const LEndDate = calculateEndDateWithoutWeekends(KEndDate, storedDurations[subTaskName12] || 2);
                const MEndDate = calculateEndDateWithoutWeekends(LEndDate, storedDurations[subTaskName13] || 1);
                const NEndDate = calculateEndDateWithoutWeekends(MEndDate, storedDurations[subTaskName14] || 1);
                const ÑEndDate = calculateEndDateWithoutWeekends(NEndDate, storedDurations[subTaskName15] || 3); // Reporte de pruebas FAT

                const colorClass = "gantt_task_color_" + ((i % 5) + 1);

                data.push(
                    {
                        id: "task" + i,
                        text: taskName,
                        start_date: startDate,
                        end_date: EndDate,
                        responsible: "",
                        css: colorClass,
                        checklist: []
                    },
                    {
                        id: "subtask_0" + i,
                        text: subTaskName1,
                        start_date: startDate,
                        parent: "task" + i,
                        end_date: AEndDate,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName1] || 1
                    },
                    {
                        id: "subtask_2" + i,
                        text: subTaskName2,
                        start_date: calculateEndDateWithoutWeekends(AEndDate, 0),
                        parent: "task" + i,
                        end_date: BEndDate,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName2] || 3
                    },
                    {
                        id: "subtask_3" + i,
                        text: subTaskName3,
                        start_date: calculateEndDateWithoutWeekends(BEndDate, 0),
                        parent: "task" + i,
                        end_date: CEndDate,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName3] || 5
                    },
                    {
                        id: "subtask_4" + i,
                        text: subTaskName4,
                        start_date: calculateEndDateWithoutWeekends(CEndDate, 0),
                        parent: "task" + i,
                        end_date: DEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName4] || 2
                    },
                    {
                        id: "subtask_5" + i,
                        text: subTaskName5,
                        start_date: calculateEndDateWithoutWeekends(DEndDate, 0),
                        parent: "task" + i,
                        end_date: EEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName5] || 3
                    },
                    {
                        id: "subtask_6" + i,
                        text: subTaskName6,
                        start_date: calculateEndDateWithoutWeekends(EEndDate, 0),
                        parent: "task" + i,
                        end_date: FEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName6] || 3
                    },
                    {
                        id: "subtask_7" + i,
                        text: subTaskName7,
                        start_date: calculateEndDateWithoutWeekends(FEndDate, 0),
                        parent: "task" + i,
                        end_date: GEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName7] || 6
                    },
                    {
                        id: "subtask_8" + i,
                        text: subTaskName8,
                        start_date: calculateEndDateWithoutWeekends(GEndDate, 0),
                        parent: "task" + i,
                        end_date: HEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName8] || 2
                    },
                    {
                        id: "subtask_9" + i,
                        text: subTaskName9,
                        start_date: calculateEndDateWithoutWeekends(HEndDate, 0),
                        parent: "task" + i,
                        end_date: IEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName9] || 4
                    },
                    {
                        id: "subtask_10" + i,
                        text: subTaskName10,
                        start_date: calculateEndDateWithoutWeekends(IEndDate, 0),
                        parent: "task" + i,
                        end_date: JEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName10] || 4
                    },
                    {
                        id: "subtask_11" + i,
                        text: subTaskName11,
                        start_date: calculateEndDateWithoutWeekends(JEndDate, 0),
                        parent: "task" + i,
                        end_date: KEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName11] || 1
                    },
                    {
                        id: "subtask_12" + i,
                        text: subTaskName12,
                        start_date: calculateEndDateWithoutWeekends(KEndDate, 0),
                        parent: "task" + i,
                        end_date: LEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName12] || 2
                    },
                    {
                        id: "subtask_13" + i,
                        text: subTaskName13,
                        start_date: calculateEndDateWithoutWeekends(LEndDate, 0),
                        parent: "task" + i,
                        end_date: MEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName13] || 1
                    },
                    {
                        id: "subtask_14" + i,
                        text: subTaskName14,
                        start_date: calculateEndDateWithoutWeekends(MEndDate, 0),
                        parent: "task" + i,
                        end_date: NEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName14] || 1
                    },
                    {
                        id: "subtask_15" + i,
                        text: subTaskName15,
                        start_date: calculateEndDateWithoutWeekends(NEndDate, 0),
                        parent: "task" + i,
                        end_date: ÑEndDate, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName15] || 3
                    }
                );
            }

            gantt.config.work_time = true;
            gantt.config.skip_off_time = true;

            gantt.init("gantt_chart");
            gantt.parse({ data });
            gantt.templates.task_class = function(start, end, task) {
                return task.css;
            };

            function updateParentDuration(parentTaskId) {
                if (!gantt.isTaskExists(parentTaskId)) {
                    return;
                }
                const subtasks = gantt.getChildren(parentTaskId);
                let totalDuration = 0;
                subtasks.forEach(subtaskId => {
                    const subtask = gantt.getTask(subtaskId);
                    totalDuration += subtask.duration;
                });
                const parentTask = gantt.getTask(parentTaskId);
                parentTask.duration = totalDuration;
                gantt.refreshTask(parentTaskId);

                const endDate = gantt.calculateEndDate(parentTask.start_date, parentTask.duration);
                endDate.setDate(endDate.getDate() - 1);
                if (endDate.getDay() === 0) {
                    endDate.setDate(endDate.getDate() - 2);
                }
                parentTask.end_date = endDate;
                gantt.refreshTask(parentTaskId);
            }

            const tasks = gantt.getTaskByTime();
            tasks.forEach(task => {
                if (!task.parent) {
                    updateParentDuration(task.id);
                }
            });

            gantt.attachEvent("onGanttRender", function() {
                const tasks = gantt.getTaskByTime();
                tasks.forEach(task => {
                    if (!task.parent) {
                        updateParentDuration(task.id);
                    }
                });

                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const taskId = this.dataset.taskId;
                        const task = gantt.getTask(taskId);
                        if (this.checked) {
                            task.checklist.push(true);
                        } else {
                            task.checklist = task.checklist.filter(item => item !== true);
                        }
                    });
                });
            });                                     

        // DEPENDENCIAS - POR SI ALGUNA SUBTAREA ES MODIFICADA EN FECHAS O DURACION - ESTABLECER NUEVAS FECHAS DE INICIO Y FIN
        gantt.attachEvent("onAfterTaskUpdate", function(taskId, task) {
            const isIncreasing = task.end_date > task.start_date;
            const taskDuration = task.duration;

            // ARRAY
            storedDurations[task.text] = taskDuration;
            localStorage.setItem(storedDurationsKey, JSON.stringify(storedDurations));

            // Guardar la nueva fecha de inicio y fin en localStorage
            startDates[taskId] = task.start_date;
            endDates[taskId] = task.end_date;
            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));


            //SI LA SUBTAREA ACTUALIZADA ES LA 1
            if (taskId.includes("subtask_0")) {
                            
                const task2Id = taskId.replace("subtask_0", "subtask_2");
                const task2 = gantt.getTask(task2Id);
                const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task2.text] || 3), isIncreasing);
                if (task2) {
                    task2.start_date = newStartDate;
                    task2.end_date = newEndDate;
                    gantt.refreshTask(task2Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task2Id] = task2.start_date;
                    endDates[task2Id] = task2.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                    const task3Id = task2Id.replace("subtask_2", "subtask_3");
                    const task3 = gantt.getTask(task3Id);
                    if (task3) {
                        const task3StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newEndDate, 0), isIncreasing);
                        const task3EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3StartDate, storedDurations[task3.text] || 5), isIncreasing);
                        task3.start_date = task3StartDate;
                        task3.end_date = task3EndDate;
                        gantt.refreshTask(task3Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task3Id] = task3.start_date;
                        endDates[task3Id] = task3.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                        const task4Id = task3Id.replace("subtask_3", "subtask_4");
                        const task4 = gantt.getTask(task4Id);
                        if (task4) {
                            const task4StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3EndDate, 0), isIncreasing);
                            const task4EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4StartDate, storedDurations[task4.text] || 2), isIncreasing);
                            task4.start_date = task4StartDate;
                            task4.end_date = task4EndDate;
                            gantt.refreshTask(task4Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task4Id] = task4.start_date;
                            endDates[task4Id] = task4.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                            const task5Id = task4Id.replace("subtask_4", "subtask_5");
                            const task5 = gantt.getTask(task5Id);
                            if (task5) {
                                const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4EndDate, 0), isIncreasing);
                                const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                                task5.start_date = task5StartDate;
                                task5.end_date = task5EndDate;
                                gantt.refreshTask(task5Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task5Id] = task5.start_date;
                                endDates[task5Id] = task5.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                                const task6Id = task5Id.replace("subtask_5", "subtask_6");
                                const task6 = gantt.getTask(task6Id);
                                if (task6) {
                                    const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5EndDate, 0), isIncreasing);
                                    const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                                    task6.start_date = task6StartDate;
                                    task6.end_date = task6EndDate;
                                    gantt.refreshTask(task6Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task6Id] = task6.start_date;
                                    endDates[task6Id] = task6.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                                    const task7Id = task6Id.replace("subtask_6", "subtask_7");
                                    const task7 = gantt.getTask(task7Id);
                                    if (task7) {
                                        const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6EndDate, 0), isIncreasing);
                                        const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                        task7.start_date = task7StartDate;
                                        task7.end_date = task7EndDate;
                                        gantt.refreshTask(task7Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task7Id] = task7.start_date;
                                        endDates[task7Id] = task7.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                        const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                        const task8 = gantt.getTask(task8Id);
                                        if (task8) {
                                            const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7EndDate, 0), isIncreasing);
                                            const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                            task8.start_date = task8StartDate;
                                            task8.end_date = task8EndDate;
                                            gantt.refreshTask(task8Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task8Id] = task8.start_date;
                                            endDates[task8Id] = task8.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                            const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                            const task9 =gantt.getTask(task9Id);
                                            if (task9) {
                                                const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8EndDate, 0), isIncreasing);
                                                const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                                task9.start_date = task9StartDate;
                                                task9.end_date = task9EndDate;
                                                gantt.refreshTask(task9Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task9Id] = task9.start_date;
                                                endDates[task9Id] = task9.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                                const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                                const task10 = gantt.getTask(task10Id);
                                                if (task10) {
                                                    const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9EndDate, 0), isIncreasing);
                                                    const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                                    task10.start_date = task10StartDate;
                                                    task10.end_date = task10EndDate;
                                                    gantt.refreshTask(task10Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task10Id] = task10.start_date;
                                                    endDates[task10Id] = task10.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                                    const task11 = gantt.getTask(task11Id);
                                                    if (task11) {
                                                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10EndDate, 0), isIncreasing);
                                                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                        task11.start_date = task11StartDate;
                                                        task11.end_date = task11EndDate;
                                                        gantt.refreshTask(task11Id);
                                                        // Guardar las nuevas fechas en localStorage
                                                        startDates[task11Id] = task11.start_date;
                                                        endDates[task11Id] = task11.end_date;
                                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                        const task12 = gantt.getTask(task12Id);
                                                        if (task12) {
                                                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11EndDate, 0), isIncreasing);
                                                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                            task12.start_date = task12StartDate;
                                                            task12.end_date = task12EndDate;
                                                            gantt.refreshTask(task12Id);
                                                            // Guardar las nuevas fechas en localStorage
                                                            startDates[task12Id] = task12.start_date;
                                                            endDates[task12Id] = task12.end_date;
                                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
    
                                                            const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                                            const task13 = gantt.getTask(task13Id);
                                                            if (task13) {
                                                                const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12EndDate, 0), isIncreasing);
                                                                const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                                                task13.start_date = task13StartDate;
                                                                task13.end_date = task13EndDate;
                                                                gantt.refreshTask(task13Id);
                                                                // Guardar las nuevas fechas en localStorage
                                                                startDates[task13Id] = task13.start_date;
                                                                endDates[task13Id] = task13.end_date;
                                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                                                const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                                                const task14 = gantt.getTask(task14Id);
                                                                if (task14) {
                                                                    const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13EndDate, 0), isIncreasing);
                                                                    const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                                    task14.start_date = task14StartDate;
                                                                    task14.end_date = task14EndDate;
                                                                    gantt.refreshTask(task14Id);
                                                                    // Guardar las nuevas fechas en localStorage
                                                                    startDates[task14Id] = task14.start_date;
                                                                    endDates[task14Id] = task14.end_date;
                                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                                    const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                                    const task15 = gantt.getTask(task15Id);
                                                                    if (task15) {
                                                                        const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14EndDate, 0), isIncreasing);
                                                                        const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                                        task15.start_date = task15StartDate;
                                                                        task15.end_date = task15EndDate;
                                                                        gantt.refreshTask(task15Id);
                                                                        // Guardar las nuevas fechas en localStorage
                                                                        startDates[task15Id] = task15.start_date;
                                                                        endDates[task15Id] = task15.end_date;
                                                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 2
            else if (taskId.includes("subtask_2")) {
            const task3Id = taskId.replace("subtask_2", "subtask_3");
            const task3 = gantt.getTask(task3Id);
            if (task3) {
                const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task3.text] || 5), isIncreasing);
                task3.start_date = newStartDate;
                task3.end_date = newEndDate;
                gantt.refreshTask(task3Id);
                // Guardar las nuevas fechas en localStorage
                startDates[task3Id] = task3.start_date;
                endDates[task3Id] = task3.end_date;
                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));


                const task4Id = task3Id.replace("subtask_3", "subtask_4");
                const task4 = gantt.getTask(task4Id);
                if (task4) {
                    const task4StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3.end_date, 0), isIncreasing);
                    const task4EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4StartDate, storedDurations[task4.text] || 2), isIncreasing);
                    task4.start_date = task4StartDate;
                    task4.end_date = task4EndDate;
                    gantt.refreshTask(task4Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task4Id] = task4.start_date;
                    endDates[task4Id] = task4.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task5Id = task4Id.replace("subtask_4", "subtask_5");
                    const task5 = gantt.getTask(task5Id);
                    if (task5) {
                        const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4.end_date, 0), isIncreasing);
                        const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                        task5.start_date = task5StartDate;
                        task5.end_date = task5EndDate;
                        gantt.refreshTask(task5Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task5Id] = task5.start_date;
                        endDates[task5Id] = task5.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task6Id = task5Id.replace("subtask_5", "subtask_6");
                        const task6 = gantt.getTask(task6Id);
                        if (task6) {
                            const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                            const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                            task6.start_date = task6StartDate;
                            task6.end_date = task6EndDate;
                            gantt.refreshTask(task6Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task6Id] = task6.start_date;
                            endDates[task6Id] = task6.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task7Id = task6Id.replace("subtask_6", "subtask_7");
                            const task7 = gantt.getTask(task7Id);
                            if (task7) {
                                const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                                const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                task7.start_date = task7StartDate;
                                task7.end_date = task7EndDate;
                                gantt.refreshTask(task7Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task7Id] = task7.start_date;
                                endDates[task7Id] = task7.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                const task8 = gantt.getTask(task8Id);
                                if (task8) {
                                    const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                    const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                    task8.start_date = task8StartDate;
                                    task8.end_date = task8EndDate;
                                    gantt.refreshTask(task8Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task8Id] = task8.start_date;
                                    endDates[task8Id] = task8.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                    const task9 = gantt.getTask(task9Id);
                                    if (task9) {
                                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                        task9.start_date = task9StartDate;
                                        task9.end_date = task9EndDate;
                                        gantt.refreshTask(task9Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task9Id] = task9.start_date;
                                        endDates[task9Id] = task9.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                        const task10 = gantt.getTask(task10Id);
                                        if (task10) {
                                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                            task10.start_date = task10StartDate;
                                            task10.end_date = task10EndDate;
                                            gantt.refreshTask(task10Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task10Id] = task10.start_date;
                                            endDates[task10Id] = task10.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                            const task11 = gantt.getTask(task11Id);
                                            if (task11) {
                                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                task11.start_date = task11StartDate;
                                                task11.end_date = task11EndDate;
                                                gantt.refreshTask(task11Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task11Id] = task11.start_date;
                                                endDates[task11Id] = task11.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                const task12 = gantt.getTask(task12Id);
                                                if (task12) {
                                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                    task12.start_date = task12StartDate;
                                                    task12.end_date = task12EndDate;
                                                    gantt.refreshTask(task12Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task12Id] = task12.start_date;
                                                    endDates[task12Id] = task12.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                        const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                                        const task13 = gantt.getTask(task13Id);
                                                        if (task13) {
                                                            const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                                            const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                                            task13.start_date = task13StartDate;
                                                            task13.end_date = task13EndDate;
                                                            gantt.refreshTask(task13Id);
                                                            // Guardar las nuevas fechas en localStorage
                                                            startDates[task13Id] = task13.start_date;
                                                            endDates[task13Id] = task13.end_date;
                                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                            const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                                            const task14 = gantt.getTask(task14Id);
                                                            if (task14) {
                                                                const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                                                const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                                task14.start_date = task14StartDate;
                                                                task14.end_date = task14EndDate;
                                                                gantt.refreshTask(task14Id);
                                                                // Guardar las nuevas fechas en localStorage
                                                                startDates[task14Id] = task14.start_date;
                                                                endDates[task14Id] = task14.end_date;
                                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                                const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                                const task15 = gantt.getTask(task15Id);
                                                                if (task15) {
                                                                    const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                                    const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                                    task15.start_date = task15StartDate;
                                                                    task15.end_date = task15EndDate;
                                                                    gantt.refreshTask(task15Id);
                                                                    // Guardar las nuevas fechas en localStorage
                                                                    startDates[task15Id] = task15.start_date;
                                                                    endDates[task15Id] = task15.end_date;
                                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 3
            else if (taskId.includes("subtask_3")) {
                
                const task4Id = taskId.replace("subtask_3", "subtask_4");
                const task4 = gantt.getTask(task4Id);
                if (task4) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task4.text] || 2), isIncreasing);
                    task4.start_date = newStartDate;
                    task4.end_date = newEndDate;
                    gantt.refreshTask(task4Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task4Id] = task4.start_date;
                    endDates[task4Id] = task4.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task5Id = task4Id.replace("subtask_4", "subtask_5");
                    const task5 = gantt.getTask(task5Id);
                    if (task5) {
                        const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4.end_date, 0), isIncreasing);
                        const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                        task5.start_date = task5StartDate;
                        task5.end_date = task5EndDate;
                        gantt.refreshTask(task5Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task5Id] = task5.start_date;
                        endDates[task5Id] = task5.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task6Id = task5Id.replace("subtask_5", "subtask_6");
                        const task6 = gantt.getTask(task6Id);
                        if (task6) {
                            const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                            const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                            task6.start_date = task6StartDate;
                            task6.end_date = task6EndDate;
                            gantt.refreshTask(task6Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task6Id] = task6.start_date;
                            endDates[task6Id] = task6.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task7Id = task6Id.replace("subtask_6", "subtask_7");
                            const task7 = gantt.getTask(task7Id);
                            if (task7) {
                                const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                                const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                task7.start_date = task7StartDate;
                                task7.end_date = task7EndDate;
                                gantt.refreshTask(task7Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task7Id] = task7.start_date;
                                endDates[task7Id] = task7.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                const task8 = gantt.getTask(task8Id);
                                if (task8) {
                                    const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                    const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                    task8.start_date = task8StartDate;
                                    task8.end_date = task8EndDate;
                                    gantt.refreshTask(task8Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task8Id] = task8.start_date;
                                    endDates[task8Id] = task8.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                    const task9 = gantt.getTask(task9Id);
                                    if (task9) {
                                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                        task9.start_date = task9StartDate;
                                        task9.end_date = task9EndDate;
                                        gantt.refreshTask(task9Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task9Id] = task9.start_date;
                                        endDates[task9Id] = task9.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                        const task10 = gantt.getTask(task10Id);
                                        if (task10) {
                                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                            task10.start_date = task10StartDate;
                                            task10.end_date = task10EndDate;
                                            gantt.refreshTask(task10Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task10Id] = task10.start_date;
                                            endDates[task10Id] = task10.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                            const task11 = gantt.getTask(task11Id);
                                            if (task11) {
                                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                task11.start_date = task11StartDate;
                                                task11.end_date = task11EndDate;
                                                gantt.refreshTask(task11Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task11Id] = task11.start_date;
                                                endDates[task11Id] = task11.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                
                                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                const task12 = gantt.getTask(task12Id);
                                                if (task12) {
                                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                    task12.start_date = task12StartDate;
                                                    task12.end_date = task12EndDate;
                                                    gantt.refreshTask(task12Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task12Id] = task12.start_date;
                                                    endDates[task12Id] = task12.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));  

                                                    const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                                    const task13 = gantt.getTask(task13Id);
                                                    if (task13) {
                                                        const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                                        const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                                        task13.start_date = task13StartDate;
                                                        task13.end_date = task13EndDate;
                                                        gantt.refreshTask(task13Id);
                                                        // Guardar las nuevas fechas en localStorage
                                                        startDates[task13Id] = task13.start_date;
                                                        endDates[task13Id] = task13.end_date;
                                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                        
                                                        const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                                        const task14 = gantt.getTask(task14Id);
                                                        if (task14) {
                                                            const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                                            const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                            task14.start_date = task14StartDate;
                                                            task14.end_date = task14EndDate;
                                                            gantt.refreshTask(task14Id);
                                                            // Guardar las nuevas fechas en localStorage
                                                            startDates[task14Id] = task14.start_date;
                                                            endDates[task14Id] = task14.end_date;
                                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                            const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                            const task15 = gantt.getTask(task15Id);
                                                            if (task15) {
                                                                const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                                const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                                task15.start_date = task15StartDate;
                                                                task15.end_date = task15EndDate;
                                                                gantt.refreshTask(task15Id);
                                                                // Guardar las nuevas fechas en localStorage
                                                                startDates[task15Id] = task15.start_date;
                                                                endDates[task15Id] = task15.end_date;
                                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 4
            else if (taskId.includes("subtask_4")) {

                const task5Id = taskId.replace("subtask_4", "subtask_5");
                const task5 = gantt.getTask(task5Id);
                if (task5) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task5.text] || 3), isIncreasing);
                    task5.start_date = newStartDate;
                    task5.end_date = newEndDate;
                    gantt.refreshTask(task5Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task5Id] = task5.start_date;
                    endDates[task5Id] = task5.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task6Id = task5Id.replace("subtask_5", "subtask_6");
                    const task6 = gantt.getTask(task6Id);
                    if (task6) {
                        const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                        const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                        task6.start_date = task6StartDate;
                        task6.end_date = task6EndDate;
                        gantt.refreshTask(task6Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task6Id] = task6.start_date;
                        endDates[task6Id] = task6.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task7Id = task6Id.replace("subtask_6", "subtask_7");
                        const task7 = gantt.getTask(task7Id);
                        if (task7) {
                            const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                            const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                            task7.start_date = task7StartDate;
                            task7.end_date = task7EndDate;
                            gantt.refreshTask(task7Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task7Id] = task7.start_date;
                            endDates[task7Id] = task7.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task8Id = task7Id.replace("subtask_7", "subtask_8");
                            const task8 = gantt.getTask(task8Id);
                            if (task8) {
                                const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                task8.start_date = task8StartDate;
                                task8.end_date = task8EndDate;
                                gantt.refreshTask(task8Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task8Id] = task8.start_date;
                                endDates[task8Id] = task8.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                const task9 = gantt.getTask(task9Id);
                                if (task9) {
                                    const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                    const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                    task9.start_date = task9StartDate;
                                    task9.end_date = task9EndDate;
                                    gantt.refreshTask(task9Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task9Id] = task9.start_date;
                                    endDates[task9Id] = task9.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                    const task10 = gantt.getTask(task10Id);
                                    if (task10) {
                                        const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                        const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                        task10.start_date = task10StartDate;
                                        task10.end_date = task10EndDate;
                                        gantt.refreshTask(task10Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task10Id] = task10.start_date;
                                        endDates[task10Id] = task10.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                        const task11 = gantt.getTask(task11Id);
                                        if (task11) {
                                            const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                            const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                            task11.start_date = task11StartDate;
                                            task11.end_date = task11EndDate;
                                            gantt.refreshTask(task11Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task11Id] = task11.start_date;
                                            endDates[task11Id] = task11.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                            const task12 = gantt.getTask(task12Id);
                                            if (task12) {
                                                const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                task12.start_date = task12StartDate;
                                                task12.end_date = task12EndDate;
                                                gantt.refreshTask(task12Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task12Id] = task12.start_date;
                                                endDates[task12Id] = task12.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                                const task13 = gantt.getTask(task13Id);
                                                if (task13) {
                                                    const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                                    const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                                    task13.start_date = task13StartDate;
                                                    task13.end_date = task13EndDate;
                                                    gantt.refreshTask(task13Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task13Id] = task13.start_date;
                                                    endDates[task13Id] = task13.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                    const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                                    const task14 = gantt.getTask(task14Id);
                                                    if (task14) {
                                                        const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                                        const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                        task14.start_date = task14StartDate;
                                                        task14.end_date = task14EndDate;
                                                        gantt.refreshTask(task14Id);

                                                        const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                        const task15 = gantt.getTask(task15Id);
                                                        if (task15) {
                                                            const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                            const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                            task15.start_date = task15StartDate;
                                                            task15.end_date = task15EndDate;
                                                            gantt.refreshTask(task15Id);
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 5
            else if (taskId.includes("subtask_5")) {

                const task6Id = taskId.replace("subtask_5", "subtask_6");
                const task6 = gantt.getTask(task6Id);
                if (task6) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task6.text] || 3), isIncreasing);
                    task6.start_date = newStartDate;
                    task6.end_date = newEndDate;
                    gantt.refreshTask(task6Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task6Id] = task6.start_date;
                    endDates[task6Id] = task6.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task7Id = task6Id.replace("subtask_6", "subtask_7");
                    const task7 = gantt.getTask(task7Id);
                    if (task7) {
                        const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                        const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                        task7.start_date = task7StartDate;
                        task7.end_date = task7EndDate;
                        gantt.refreshTask(task7Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task7Id] = task7.start_date;
                        endDates[task7Id] = task7.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task8Id = task7Id.replace("subtask_7", "subtask_8");
                        const task8 = gantt.getTask(task8Id);
                        if (task8) {
                            const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                            const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                            task8.start_date = task8StartDate;
                            task8.end_date = task8EndDate;
                            gantt.refreshTask(task8Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task8Id] = task8.start_date;
                            endDates[task8Id] = task8.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task9Id = task8Id.replace("subtask_8", "subtask_9");
                            const task9 = gantt.getTask(task9Id);
                            if (task9) {
                                const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                task9.start_date = task9StartDate;
                                task9.end_date = task9EndDate;
                                gantt.refreshTask(task9Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task9Id] = task9.start_date;
                                endDates[task9Id] = task9.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                const task10 = gantt.getTask(task10Id);
                                if (task10) {
                                    const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                    const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                    task10.start_date = task10StartDate;
                                    task10.end_date = task10EndDate;
                                    gantt.refreshTask(task10Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task10Id] = task10.start_date;
                                    endDates[task10Id] = task10.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                    const task11 = gantt.getTask(task11Id);
                                    if (task11) {
                                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                        task11.start_date = task11StartDate;
                                        task11.end_date = task11EndDate;
                                        gantt.refreshTask(task11Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task11Id] = task11.start_date;
                                        endDates[task11Id] = task11.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                        const task12 = gantt.getTask(task12Id);
                                        if (task12) {
                                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                            task12.start_date = task12StartDate;
                                            task12.end_date = task12EndDate;
                                            gantt.refreshTask(task12Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task12Id] = task12.start_date;
                                            endDates[task12Id] = task12.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                            const task13 = gantt.getTask(task13Id);
                                            if (task13) {
                                                const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                                const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                                task13.start_date = task13StartDate;
                                                task13.end_date = task13EndDate;
                                                gantt.refreshTask(task13Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task13Id] = task13.start_date;
                                                endDates[task13Id] = task13.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                                const task14 = gantt.getTask(task14Id);
                                                if (task14) {
                                                    const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                                    const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                    task14.start_date = task14StartDate;
                                                    task14.end_date = task14EndDate;
                                                    gantt.refreshTask(task14Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task14Id] = task14.start_date;
                                                    endDates[task14Id] = task14.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                    const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                    const task15 = gantt.getTask(task15Id);
                                                    if (task15) {
                                                        const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                        const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                        task15.start_date = task15StartDate;
                                                        task15.end_date = task15EndDate;
                                                        gantt.refreshTask(task15Id);
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 6 
            else if (taskId.includes("subtask_6")) {

                const task7Id = taskId.replace("subtask_6", "subtask_7");
                const task7 = gantt.getTask(task7Id);
                if (task7) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task7.text] || 6), isIncreasing);
                    task7.start_date = newStartDate;
                    task7.end_date = newEndDate;
                    gantt.refreshTask(task7Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task7Id] = task7.start_date;
                    endDates[task7Id] = task7.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task8Id = task7Id.replace("subtask_7", "subtask_8");
                    const task8 = gantt.getTask(task8Id);
                    if (task8) {
                        const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                        const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                        task8.start_date = task8StartDate;
                        task8.end_date = task8EndDate;
                        gantt.refreshTask(task8Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task8Id] = task8.start_date;
                        endDates[task8Id] = task8.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task9Id = task8Id.replace("subtask_8", "subtask_9");
                        const task9 = gantt.getTask(task9Id);
                        if (task9) {
                            const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                            const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                            task9.start_date = task9StartDate;
                            task9.end_date = task9EndDate;
                            gantt.refreshTask(task9Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task9Id] = task9.start_date;
                            endDates[task9Id] = task9.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task10Id = task9Id.replace("subtask_9", "subtask_10");
                            const task10 = gantt.getTask(task10Id);
                            if (task10) {
                                const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                task10.start_date = task10StartDate;
                                task10.end_date = task10EndDate;
                                gantt.refreshTask(task10Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task10Id] = task10.start_date;
                                endDates[task10Id] = task10.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                const task11 = gantt.getTask(task11Id);
                                if (task11) {
                                    const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                    const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                    task11.start_date = task11StartDate;
                                    task11.end_date = task11EndDate;
                                    gantt.refreshTask(task11Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task11Id] = task11.start_date;
                                    endDates[task11Id] = task11.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                    const task12 = gantt.getTask(task12Id);
                                    if (task12) {
                                        const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                        const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                        task12.start_date = task12StartDate;
                                        task12.end_date = task12EndDate;
                                        gantt.refreshTask(task12Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task12Id] = task12.start_date;
                                        endDates[task12Id] = task12.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                        const task13 = gantt.getTask(task13Id);
                                        if (task13) {
                                            const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                            const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                            task13.start_date = task13StartDate;
                                            task13.end_date = task13EndDate;
                                            gantt.refreshTask(task13Id);

                                            const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                            const task14 = gantt.getTask(task14Id);
                                            if (task14) {
                                                const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                                const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                                task14.start_date = task14StartDate;
                                                task14.end_date = task14EndDate;
                                                gantt.refreshTask(task14Id);

                                                const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                                const task15 = gantt.getTask(task15Id);
                                                if (task15) {
                                                    const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                    const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                    task15.start_date = task15StartDate;
                                                    task15.end_date = task15EndDate;
                                                    gantt.refreshTask(task15Id);
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 7    
            else if (taskId.includes("subtask_7")) {

                const task8Id = taskId.replace("subtask_7", "subtask_8");
                const task8 = gantt.getTask(task8Id);
                if (task8) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task8.text] || 2), isIncreasing);
                    task8.start_date = newStartDate;
                    task8.end_date = newEndDate;
                    gantt.refreshTask(task8Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task8Id] = task8.start_date;
                    endDates[task8Id] = task8.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                    const task9 = gantt.getTask(task9Id);
                    if (task9) {
                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                        task9.start_date = task9StartDate;
                        task9.end_date = task9EndDate;
                        gantt.refreshTask(task9Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task9Id] = task9.start_date;
                        endDates[task9Id] = task9.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                        const task10 = gantt.getTask(task10Id);
                        if (task10) {
                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                            task10.start_date = task10StartDate;
                            task10.end_date = task10EndDate;
                            gantt.refreshTask(task10Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task10Id] = task10.start_date;
                            endDates[task10Id] = task10.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                            const task11 = gantt.getTask(task11Id);
                            if (task11) {
                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                task11.start_date = task11StartDate;
                                task11.end_date = task11EndDate;
                                gantt.refreshTask(task11Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task11Id] = task11.start_date;
                                endDates[task11Id] = task11.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                const task12 = gantt.getTask(task12Id);
                                if (task12) {
                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                    task12.start_date = task12StartDate;
                                    task12.end_date = task12EndDate;
                                    gantt.refreshTask(task12Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task12Id] = task12.start_date;
                                    endDates[task12Id] = task12.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                    const task13 = gantt.getTask(task13Id);
                                    if (task13) {
                                        const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                        const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                        task13.start_date = task13StartDate;
                                        task13.end_date = task13EndDate;
                                        gantt.refreshTask(task13Id);

                                        const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                        const task14 = gantt.getTask(task14Id);
                                        if (task14) {
                                            const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                            const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                            task14.start_date = task14StartDate;
                                            task14.end_date = task14EndDate;
                                            gantt.refreshTask(task14Id);

                                            const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                            const task15 = gantt.getTask(task15Id);
                                            if (task15) {
                                                const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                                const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                                task15.start_date = task15StartDate;
                                                task15.end_date = task15EndDate;
                                                gantt.refreshTask(task15Id);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 8 
            else if (taskId.includes("subtask_8")) {

                const task9Id = taskId.replace("subtask_8", "subtask_9");
                const task9 = gantt.getTask(task9Id);
                if (task9) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task9.text] || 4), isIncreasing);
                    task9.start_date = newStartDate;
                    task9.end_date = newEndDate;
                    gantt.refreshTask(task9Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task9Id] = task9.start_date;
                    endDates[task9Id] = task9.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task10Id = task9Id.replace("subtask_9", "subtask_10");
                    const task10 = gantt.getTask(task10Id);
                    if (task10) {
                        const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                        const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                        task10.start_date = task10StartDate;
                        task10.end_date = task10EndDate;
                        gantt.refreshTask(task10Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task10Id] = task10.start_date;
                        endDates[task10Id] = task10.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                        

                        const task11Id = task10Id.replace("subtask_10", "subtask_11");
                        const task11 = gantt.getTask(task11Id);
                        if (task11) {
                            const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                            const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                            task11.start_date = task11StartDate;
                            task11.end_date = task11EndDate;
                            gantt.refreshTask(task11Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task11Id] = task11.start_date;
                            endDates[task11Id] = task11.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task12Id = task11Id.replace("subtask_11", "subtask_12");
                            const task12 = gantt.getTask(task12Id);
                            if (task12) {
                                const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                task12.start_date = task12StartDate;
                                task12.end_date = task12EndDate;
                                gantt.refreshTask(task12Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task12Id] = task12.start_date;
                                endDates[task12Id] = task12.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task13Id = task12Id.replace("subtask_12", "subtask_13");
                                const task13 = gantt.getTask(task13Id);
                                if (task13) {
                                    const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                    const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                    task13.start_date = task13StartDate;
                                    task13.end_date = task13EndDate;
                                    gantt.refreshTask(task13Id);

                                    const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                    const task14 = gantt.getTask(task14Id);
                                    if (task14) {
                                        const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                        const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                        task14.start_date = task14StartDate;
                                        task14.end_date = task14EndDate;
                                        gantt.refreshTask(task14Id);

                                        const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                        const task15 = gantt.getTask(task15Id);
                                        if (task15) {
                                            const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                            const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                            task15.start_date = task15StartDate;
                                            task15.end_date = task15EndDate;
                                            gantt.refreshTask(task15Id);
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 9 
            else if (taskId.includes("subtask_9")) {

                const task10Id = taskId.replace("subtask_9", "subtask_10");
                const task10 = gantt.getTask(task10Id);
                if (task10) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task10.text] || 4), isIncreasing);
                    task10.start_date = newStartDate;
                    task10.end_date = newEndDate;
                    gantt.refreshTask(task10Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task10Id] = task10.start_date;
                    endDates[task10Id] = task10.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                    const task11 = gantt.getTask(task11Id);
                    if (task11) {
                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                        task11.start_date = task11StartDate;
                        task11.end_date = task11EndDate;
                        gantt.refreshTask(task11Id);    
                        // Guardar las nuevas fechas en localStorage
                        startDates[task11Id] = task11.start_date;
                        endDates[task11Id] = task11.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                        const task12 = gantt.getTask(task12Id);
                        if (task12) {
                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                            task12.start_date = task12StartDate;
                            task12.end_date = task12EndDate;
                            gantt.refreshTask(task12Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task12Id] = task12.start_date;
                            endDates[task12Id] = task12.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task13Id = task12Id.replace("subtask_12", "subtask_13");
                            const task13 = gantt.getTask(task13Id);
                            if (task13) {
                                const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                                const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                                task13.start_date = task13StartDate;
                                task13.end_date = task13EndDate;
                                gantt.refreshTask(task13Id);

                                const task14Id = task13Id.replace("subtask_13", "subtask_14");
                                const task14 = gantt.getTask(task14Id);
                                if (task14) {
                                    const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                    const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                    task14.start_date = task14StartDate;
                                    task14.end_date = task14EndDate;
                                    gantt.refreshTask(task14Id);

                                    const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                    const task15 = gantt.getTask(task15Id);
                                    if (task15) {
                                        const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                        const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                        task15.start_date = task15StartDate;
                                        task15.end_date = task15EndDate;
                                        gantt.refreshTask(task15Id);
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 10    
            else if (taskId.includes("subtask_10")) {

                const task11Id = taskId.replace("subtask_10", "subtask_11");
                const task11 = gantt.getTask(task11Id);
                if (task11) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task11.text] || 1), isIncreasing);
                    task11.start_date = newStartDate;
                    task11.end_date = newEndDate;
                    gantt.refreshTask(task11Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task11Id] = task11.start_date;
                    endDates[task11Id] = task11.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task12Id = task11Id.replace("subtask_11", "subtask_12");
                    const task12 = gantt.getTask(task12Id);
                    if (task12) {
                        const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                        const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                        task12.start_date = task12StartDate;
                        task12.end_date = task12EndDate;
                        gantt.refreshTask(task12Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task12Id] = task12.start_date;
                        endDates[task12Id] = task12.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task13Id = task12Id.replace("subtask_12", "subtask_13");
                        const task13 = gantt.getTask(task13Id);
                        if (task13) {
                            const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                            const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                            task13.start_date = task13StartDate;
                            task13.end_date = task13EndDate;
                            gantt.refreshTask(task13Id);

                            const task14Id = task13Id.replace("subtask_13", "subtask_14");
                            const task14 = gantt.getTask(task14Id);
                            if (task14) {
                                const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                                const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                                task14.start_date = task14StartDate;
                                task14.end_date = task14EndDate;
                                gantt.refreshTask(task14Id);

                                const task15Id = task14Id.replace("subtask_14", "subtask_15");
                                const task15 = gantt.getTask(task15Id);
                                if (task15) {
                                    const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                    const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                    task15.start_date = task15StartDate;
                                    task15.end_date = task15EndDate;
                                    gantt.refreshTask(task15Id);
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 11
            else if (taskId.includes("subtask_11")) {

                const task12Id = taskId.replace("subtask_11", "subtask_12");
                const task12 = gantt.getTask(task12Id);
                if (task12) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task12.text] || 2), isIncreasing);
                    task12.start_date = newStartDate;
                    task12.end_date = newEndDate;
                    gantt.refreshTask(task12Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task12Id] = task12.start_date;
                    endDates[task12Id] = task12.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task13Id = task12Id.replace("subtask_12", "subtask_13");
                    const task13 = gantt.getTask(task13Id);
                    if (task13) {
                        const task13StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12.end_date, 0), isIncreasing);
                        const task13EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13StartDate, storedDurations[task13.text] || 1), isIncreasing);
                        task13.start_date = task13StartDate;
                        task13.end_date = task13EndDate;
                        gantt.refreshTask(task13Id);

                        const task14Id = task13Id.replace("subtask_13", "subtask_14");
                        const task14 = gantt.getTask(task14Id);
                        if (task14) {
                            const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                            const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                            task14.start_date = task14StartDate;
                            task14.end_date = task14EndDate;
                            gantt.refreshTask(task14Id);

                            const task15Id = task14Id.replace("subtask_14", "subtask_15");
                            const task15 = gantt.getTask(task15Id);
                            if (task15) {
                                const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                                const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                                task15.start_date = task15StartDate;
                                task15.end_date = task15EndDate;
                                gantt.refreshTask(task15Id);
                            }
                        }
                    }
                } //SI LA SUBTAREA ACTUALIZADA ES LA 12
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 12
            else if (taskId.includes("subtask_12")) {

                const task13Id = taskId.replace("subtask_12", "subtask_13");
                const task13 = gantt.getTask(task13Id);
                if (task13) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task13.text] || 1), isIncreasing);
                    task13.start_date = newStartDate;
                    task13.end_date = newEndDate;
                    gantt.refreshTask(task13Id);

                    const task14Id = task13Id.replace("subtask_13", "subtask_14");
                    const task14 = gantt.getTask(task14Id);
                    if (task14) {
                        const task14StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task13.end_date, 0), isIncreasing);
                        const task14EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14StartDate, storedDurations[task14.text] || 1), isIncreasing);
                        task14.start_date = task14StartDate;
                        task14.end_date = task14EndDate;
                        gantt.refreshTask(task14Id);

                        const task15Id = task14Id.replace("subtask_14", "subtask_15");
                        const task15 = gantt.getTask(task15Id);
                        if (task15) {
                            const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                            const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                            task15.start_date = task15StartDate;
                            task15.end_date = task15EndDate;
                            gantt.refreshTask(task15Id);
                        }
                    }
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 13
            else if (taskId.includes("subtask_13")) {

                const task14Id = taskId.replace("subtask_13", "subtask_14");
                const task14 = gantt.getTask(task14Id);
                if (task14) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task14.text] || 1), isIncreasing);
                    task14.start_date = newStartDate;
                    task14.end_date = newEndDate;
                    gantt.refreshTask(task14Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task14Id] = task14.start_date;
                    endDates[task14Id] = task14.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task15Id = task14Id.replace("subtask_14", "subtask_15");
                    const task15 = gantt.getTask(task15Id);
                    if (task15) {
                        const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                        const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                        task15.start_date = task15StartDate;
                        task15.end_date = task15EndDate;
                        gantt.refreshTask(task15Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task15Id] = task15.start_date;
                        endDates[task15Id] = task15.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    }
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 14
            else if (taskId.includes("subtask_14")) {

                const task15Id = taskId.replace("subtask_14", "subtask_15");
                const task15 = gantt.getTask(task15Id);
                if (task15) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task15.text] || 3), isIncreasing);
                    task15.start_date = newStartDate;
                    task15.end_date = newEndDate;
                    gantt.refreshTask(task15Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task15Id] = task15.start_date;
                    endDates[task15Id] = task15.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 15
            else if (taskId.includes("subtask_15")) {
                            
            }
                const parentTaskId = gantt.getTask(taskId).parent;
                    if (gantt.isTaskExists(parentTaskId)) {
                    updateParentDuration(parentTaskId);
                    }

            });

            function checkTaskDates() {
                const tasks = gantt.getTaskByTime();
                tasks.forEach(task => {
                    if (!task.parent) {
                        const parentEndDate = gantt.date.add(task.original_new_end_date, 1, "day");
                        const subtasks = gantt.getChildren(task.id);
                        let isOutOfTime = false;
                        subtasks.forEach(subtaskId => {
                            const subtask = gantt.getTask(subtaskId);
                            if (subtask.text.includes("Reporte de pruebas (Rutina o Dossier)")) {
                                const subtaskEndDate = subtask.original_new_end_date;
                                if (parentEndDate < subtaskEndDate) {
                                    isOutOfTime = true;
                                }
                            }
                        });

                        const warningText = "Reduce tiempos";
                        const warningTextStyled = " <small style='font-size: 0.75em; color: red;'>" + warningText + "</small>";
                        if (isOutOfTime) {
                            if (!task.text.includes(warningText)) {
                                task.text = task.text + warningTextStyled;
                            }
                        } else {
                            if (task.text.includes(warningText)) {
                                task.text = task.text.replace(warningTextStyled, "");
                            }
                        }
                        gantt.refreshTask(task.id);
                    }
                });
            }

            gantt.attachEvent("onGanttRender", function() {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskAdd", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskUpdate", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskDelete", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onLightbox", function(taskId) {
                const select = document.querySelector(".gantt_cal_ltext select");
                const task = gantt.getTask(taskId);

                if (task) {
                    let parentTask = null;
                    gantt.eachTask(function(taskItem) {
                        if (taskItem.id === task.parent) {
                            parentTask = taskItem;
                            return false;
                        }
                    });

                    if (parentTask) {
                        if (parentTask.responsible) {
                            const options = taskResponsibles[parentTask.responsible] || [];
                            select.innerHTML = "";
                            options.forEach(option => {
                                const newOption = document.createElement("option");
                                newOption.value = option;
                                newOption.text = option;
                                select.add(newOption);
                            });
                        } else {
                            select.innerHTML = "";
                            const warningOption = document.createElement("option");
                            warningOption.value = "";
                            warningOption.text = "COLOCAR ÁREA EN TAREA PADRE";
                            select.add(warningOption);
                        }
                    } else {
                        select.innerHTML = "";
                        Object.keys(taskResponsibles).forEach(key => {
                            const newOption = document.createElement("option");
                            newOption.value = key;
                            newOption.text = key;
                            select.add(newOption);
                        });
                    }
                } else {
                    select.innerHTML = "";
                    Object.keys(taskResponsibles).forEach(key => {
                        const newOption = document.createElement("option");
                        newOption.value = key;
                        newOption.text = key;
                        select.add(newOption);
                    });
                }
            });

            gantt.parse({ data });
            gantt.templates.task_class = function(start, end, task) {
                return task.css;
            };

        };

        
    </script>
</body>
</html>


<!DOCTYPE html>   
<html lang="es">
<head> 
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROYECTO - GANTT</title>
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <link rel="stylesheet" href="Menu2.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gantt_grid_data .gantt_cell:nth-child(2),
        .gantt_grid_data .gantt_cell:nth-child(5),
        .gantt_grid_data .gantt_cell:nth-child(9),
        .gantt_grid_data .gantt_cell:nth-child(10) {
            border-right: 2px solid #e7e3e3;
        }
        .client-name {
            font-size: 1em; /*TAMAÑO*/
        }
    </style>
</head>
<body>
    <!-- NOMBRE DE LA PAGINA -->
    <div id="Titulo" class="g-container">
        <h1>CLIENTE: <span id="clientName" class="client-name"></span></h1>
    </div>

    <!-- MENU INTERACTIVO -->
    <div id="MenuG" class="s-container">
        <div class="ganttM">
            <ul>
                <li id="menu-gantt" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-chart-gantt"></i>
                        <span>Gantt</span>
                    </a>
                </li>
                <li id="Kanba" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-users"></i>
                        <span>Panel</span>
                    </a>
                </li>
                <li id="Graficos" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-chart-pie"></i>
                        <span>Graficos</span>
                    </a>
                </li>
                <li id="Reportes" style="--clr: #2483ff;">
                    <a href="#">
                        <i class="fa-solid fa-file"></i>
                        <span>Reportes</span>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <button id="toggleLockButton">Bloquear</button>

    <div id="gantt_chart" style="width: 217vh; height: 85vh;"></div>
    <script>
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const clientName = urlParams.get('clientName');
            const totalItems = parseInt(urlParams.get('totalItems'));
            const clientOrder = urlParams.get('clientOrder');
            const options = JSON.parse(urlParams.get('options'));
            const idItems = JSON.parse(urlParams.get('idItems'));
            const idColumna = JSON.parse(urlParams.get('idColumna'));
            const difficulty = JSON.parse(urlParams.get('difficulty'));
            const date = JSON.parse(urlParams.get('date'));
            const dateF = JSON.parse(urlParams.get('dateF'));

            document.getElementById('clientName').textContent = clientName;

            const storedDurationsKey = 'taskDurations_' + clientName;
            const storedDurations = JSON.parse(localStorage.getItem(storedDurationsKey)) || {};

            const lockStateKey = 'lockState';
            let lockState = localStorage.getItem(lockStateKey) === 'true';

            function toggleLock() {
                lockState = !lockState;
                localStorage.setItem(lockStateKey, lockState);
                document.getElementById('toggleLockButton').textContent = lockState ? 'Desbloquear' : 'Bloquear';
                gantt.refreshData();
            }

            document.getElementById('toggleLockButton').textContent = lockState ? 'Desbloquear' : 'Bloquear';
            document.getElementById('toggleLockButton').addEventListener('click', toggleLock);

            const fixedDurations = {
                "Aceptación de proyecto": 1,
                "Documentos para aprobación": 3,
                "Aprobación - cliente": 5,
                "Liberación - RIPA": 2,
                "Analizar RIPA": 3,
                "Reporte de fecha RIPA": 3,
                "Liberación - lista": 6,
                "Liberación de WORKFLOW": 2,
                "Analizar lista": 4,
                "Reporte de fecha - lista": 4,
                "Documentos para fabricación": 1,
                "Asignación de rutas": 2,
                "Fabricación": 1,
                "Reporte de pruebas FAT": 1,
                "Reporte de pruebas (Rutina o Dossier)": 3
            };

            gantt.config.xml_date = "%Y-%m-%d %H:%i";
            gantt.config.lightbox.sections = [
                { name: "description", height: 70, map_to: "text", type: "textarea", focus: true },
                { name: "time", height: 72, type: "duration", map_to: "auto" },
                { name: "responsible", height: 20, map_to: "responsible", type: "select", options: [
                    { key: "INGENIERIA", label: "INGENIERIA" },
                    { key: "COMPRAS", label: "COMPRAS" },
                    { key: "PCP", label: "PCP" },
                    { key: "AREA", label: "AREA" }
                ] }
            ];
            gantt.locale.labels.section_description = "Tarea";
            gantt.locale.labels.section_time = "Duración";
            gantt.locale.labels.section_responsible = "Responsable";

            gantt.config.columns = gantt.config.columns.map(column => {
                switch (column.name) {
                    case "text":
                        return { name: "text", label: "ACTIVIDAD", tree: true, width: 300 };
                    case "start_date":
                        return { name: "start_date", label: "INICIO/REAL", align: "center", width: 72 };
                    case "duration":
                        return { name: "duration", label: "DURACIÓN", align: "center", width: 53 };
                    default:
                        return column;
                }
            });

            gantt.config.columns.unshift(
                { name: "checklist", label: "☑_☑", width: 25, template: function(task) {
                    return '<input type="checkbox" class="task-checkbox" data-task-id="' + task.id + '">';
                }}
            );

            gantt.config.columns.push({
                name: "new_start_date",
                label: "INICIO/IDEAL",
                align: "center",
                width: 72,
                template: function(task) {
                    if (lockState && ["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(task.text.split(".- ")[1])) {
                        return gantt.templates.date_grid(task.originalStartDate);
                    }
                    if (task.$level === 0) {
                        return gantt.templates.date_grid(task.start_date);
                    } else {  
                        if (["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(task.text.split(".- ")[1])) {
                            return gantt.templates.date_grid(task.start_date);
                        }
                        return gantt.templates.date_grid(task.originalStartDate);
                    }
                }
            });
            gantt.config.columns.splice(2, 0, gantt.config.columns.pop());

            gantt.config.columns.push({
                name: "new_end_date",
                label: "FIN/IDEAL",
                align: "center",
                width: 72,
                template: function(task) {
                    if (lockState && ["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(task.text.split(".- ")[1])) {
                        const originalEndDate = new Date(task.originalEndDate);
                        originalEndDate.setDate(originalEndDate.getDate() - 1);
                        if (originalEndDate.getDay() === 0) {
                            originalEndDate.setDate(originalEndDate.getDate() - 2);
                        }
                        return gantt.templates.date_grid(originalEndDate);
                    }
                    if (task.$level === 0) {
                        const dateFormatted = gantt.templates.date_grid(new Date(task.original_end_date));
                        return `<span title="FECHA OFERTADA CON EL CLIENTE" style="font-size: inherit; text-decoration: underline; text-decoration-color: #0ac40a;">${dateFormatted}</span>`;
                    } else {
                        if (["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(task.text.split(".- ")[1])) {
                            const endDate = gantt.calculateEndDate(task.start_date, task.duration);
                            endDate.setDate(endDate.getDate() - 1);
                            if (endDate.getDay() === 0) {
                                endDate.setDate(endDate.getDate() - 2);
                            }
                            return gantt.templates.date_grid(endDate);
                        }
                        if (task.originalEndDate) {
                            const originalEndDate = new Date(task.originalEndDate);
                            originalEndDate.setDate(originalEndDate.getDate() - 1);
                            if (originalEndDate.getDay() === 0) {
                                originalEndDate.setDate(originalEndDate.getDate() - 2);
                            }
                            const originalEndDateFormatted = gantt.templates.date_grid(originalEndDate);
                            return originalEndDateFormatted;
                        }
                        return gantt.templates.date_grid(task.end_date);
                    }
                }
            });
            gantt.config.columns.splice(3, 0, gantt.config.columns.pop());

            gantt.config.columns.push({
                name: "establecido",
                label: "IDEAL",
                align: "center",
                width: 60,
                template: function(task) {
                    if (task.hasOwnProperty('idealProgress')) {
                        return task.idealProgress + '%';
                    }

                    const taskPercentages = {
                        "Aceptación de proyecto": 1,
                        "Documentos para aprobación": 5,
                        "Aprobación - cliente": 2,
                        "Liberación - RIPA": 4,
                        "Analizar RIPA": 1,
                        "Reporte de fecha RIPA": 10,
                        "Liberación - lista": 16,
                        "Liberación de WORKFLOW": 1,
                        "Analizar lista": 1,
                        "Reporte de fecha - lista": 20,
                        "Documentos para fabricación": 6,
                        "Asignación de rutas": 1,
                        "Fabricación": 30,
                        "Reporte de pruebas FAT": 1,
                        "Reporte de pruebas (Rutina o Dossier)": 1
                    };

                    if (task.$level === 0) {
                        const subtasks = gantt.getChildren(task.id);
                        let totalProgress = 0;

                        subtasks.forEach(subtaskId => {
                            const subtask = gantt.getTask(subtaskId);
                            const taskName = subtask.text.split(".- ")[1];
                            let progressPercentage;

                            if (["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(taskName)) {
                                const startDate = subtask.start_date;
                                const endDate = new Date(subtask.end_date);
                                endDate.setDate(endDate.getDate() - 1);
                                if (endDate.getDay() === 0) {
                                    endDate.setDate(endDate.getDate() - 2);
                                }

                                const today = new Date();
                                const totalRealDays = calculateTotalDays(startDate, endDate);
                                const elapsedRealDays = calculateTotalDays(startDate, today);
                                const taskPercentage = taskPercentages[taskName] || 100;
                                progressPercentage = (elapsedRealDays / totalRealDays) * taskPercentage;
                            } else {
                                const startDate = new Date(subtask.originalStartDate);
                                const endDate = new Date(subtask.originalEndDate);
                                endDate.setDate(endDate.getDate() - 1);
                                if (endDate.getDay() === 0) {
                                    endDate.setDate(endDate.getDate() - 2);
                                }

                                const today = new Date();
                                const elapsedIdealDays = Math.min(calculateTotalDays(startDate, today), calculateTotalDays(startDate, endDate));
                                const duration = fixedDurations[taskName] || 0;
                                const taskPercentage = taskPercentages[taskName] || 100;
                                progressPercentage = (elapsedIdealDays / duration) * taskPercentage;
                            }

                            totalProgress += Math.min(progressPercentage, taskPercentages[taskName] || 100);
                        });

                        task.idealProgress = totalProgress.toFixed(2);
                        return task.idealProgress + '%';
                    } else {
                        const taskName = task.text.split(".- ")[1];
                        let progressPercentage;

                        if (["Fabricación", "Reporte de pruebas FAT", "Reporte de pruebas (Rutina o Dossier)"].includes(taskName)) {
                            const startDate = task.start_date;
                            const endDate = new Date(task.end_date);
                            endDate.setDate(endDate.getDate() - 1);
                            if (endDate.getDay() === 0) {
                                endDate.setDate(endDate.getDate() - 2);
                            }

                            const today = new Date();
                            const totalRealDays = calculateTotalDays(startDate, endDate);
                            const elapsedRealDays = calculateTotalDays(startDate, today);
                            const taskPercentage = taskPercentages[taskName] || 100;
                            progressPercentage = (elapsedRealDays / totalRealDays) * taskPercentage;
                        } else {
                            const startDate = new Date(task.originalStartDate);
                            const endDate = new Date(task.originalEndDate);
                            endDate.setDate(endDate.getDate() - 1);
                            if (endDate.getDay() === 0) {
                                endDate.setDate(endDate.getDate() - 2);
                            }

                            const today = new Date();
                            const elapsedIdealDays = Math.min(calculateTotalDays(startDate, today), calculateTotalDays(startDate, endDate));
                            const duration = fixedDurations[taskName] || 0;
                            const taskPercentage = taskPercentages[taskName] || 100;
                            progressPercentage = (elapsedIdealDays / duration) * taskPercentage;
                        }

                        task.idealProgress = Math.min(progressPercentage, taskPercentages[taskName] || 100).toFixed(2);
                        return task.idealProgress + '%';
                    }
                }
            });
            gantt.config.columns.splice(4, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "end_date", label: "FIN/REAL", align: "center", width: 80, template: function(task) {
                    const endDate = gantt.calculateEndDate(task.start_date, task.duration);
                    endDate.setDate(endDate.getDate() - 1);

                    if (endDate.getDay() === 0) {
                        endDate.setDate(endDate.getDate() - 2);
                    }

                    return gantt.templates.date_grid(endDate);
                }}
            );
            gantt.config.columns.splice(7, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "real", label: "REAL", align: "center", width: 60, template: function(task) {
                    if (task.$level === 0) {
                        const subtasks = gantt.getChildren(task.id);
                        let totalProgress = 0;

                        subtasks.forEach(subtaskId => {
                            const subtask = gantt.getTask(subtaskId);
                            const startDate = subtask.start_date;
                            const endDate = new Date(subtask.end_date);
                            endDate.setDate(endDate.getDate() - 1);

                            const today = new Date();
                            const totalRealDays = calculateTotalDays(startDate, endDate);
                            const elapsedRealDays = calculateTotalDays(startDate, today);
                            let taskPercentage = 100;

                            if (subtask.text.includes("Aceptación de proyecto")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Documentos para aprobación")) {
                                taskPercentage = 5;
                            } else if (subtask.text.includes("Aprobación - cliente")) {
                                taskPercentage = 2;
                            } else if (subtask.text.includes("Liberación - RIPA")) {
                                taskPercentage = 4;
                            } else if (subtask.text.includes("Analizar RIPA")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de fecha RIPA")) {
                                taskPercentage = 10;
                            } else if (subtask.text.includes("Liberación - lista")) {
                                taskPercentage = 16;
                            } else if (subtask.text.includes("Liberación de WORKFLOW")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Analizar lista")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de fecha - lista")) {
                                taskPercentage = 20;
                            } else if (subtask.text.includes("Documentos para fabricación")) {
                                taskPercentage = 6;
                            } else if (subtask.text.includes("Asignación de rutas")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Fabricación")) {
                                taskPercentage = 30;
                            } else if (subtask.text.includes("Reporte de pruebas FAT")) {
                                taskPercentage = 1;
                            } else if (subtask.text.includes("Reporte de pruebas (Rutina o Dossier)")) {
                                taskPercentage = 1;
                            }

                            const progressPercentage = (elapsedRealDays / totalRealDays) * taskPercentage;
                            totalProgress += Math.min(progressPercentage, taskPercentage);
                        });

                        return totalProgress.toFixed(2) + '%';
                    } else {
                        const startDate = task.start_date;
                        const endDate = new Date(task.end_date);
                        endDate.setDate(endDate.getDate() - 1);

                        const today = new Date();
                        const totalRealDays = calculateTotalDays(startDate, endDate);
                        const elapsedRealDays = calculateTotalDays(startDate, today);
                        let taskPercentage = 100;

                        if (task.text.includes("Aceptación de proyecto")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Documentos para aprobación")) {
                            taskPercentage = 5;
                        } else if (task.text.includes("Aprobación - cliente")) {
                            taskPercentage = 2;
                        } else if (task.text.includes("Liberación - RIPA")) {
                            taskPercentage = 4;
                        } else if (task.text.includes("Analizar RIPA")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de fecha RIPA")) {
                            taskPercentage = 10;
                        } else if (task.text.includes("Liberación - lista")) {
                            taskPercentage = 16;
                        } else if (task.text.includes("Liberación de WORKFLOW")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Analizar lista")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de fecha - lista")) {
                            taskPercentage = 20;
                        } else if (task.text.includes("Documentos para fabricación")) {
                            taskPercentage = 6;
                        } else if (task.text.includes("Asignación de rutas")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Fabricación")) {
                            taskPercentage = 30;
                        } else if (task.text.includes("Reporte de pruebas FAT")) {
                            taskPercentage = 1;
                        } else if (task.text.includes("Reporte de pruebas (Rutina o Dossier)")) {
                            taskPercentage = 1;
                        }

                        const progressPercentage = (elapsedRealDays / totalRealDays) * taskPercentage;
                        return Math.min(progressPercentage, taskPercentage).toFixed(2) + '%';
                    }
                }}
            );
            gantt.config.columns.splice(8, 0, gantt.config.columns.pop());

            gantt.config.columns.push(
                { name: "responsible", label: "RESPONSABLE", align: "center", width: 85, template: function(task) {
                    return task.responsible || "";
                }}
            );
            gantt.config.columns.splice(9, 0, gantt.config.columns.pop());

            const taskNameColumn = gantt.config.columns.find(column => column.name === "text");
            taskNameColumn.width = 300;

            const taskResponsibles = {
                INGENIERIA: ["Fermin Flores", "Antonio"],
                COMPRAS: ["Orbelin", "Cinthya", "Saul", "Ariana", "Daniela"],
                PCP: ["Janet"],
                PROCESOS: ["Erik"],
                AREA: ["Fermin Flores", "Antonio", "Orbelin", "Cinthya", "Saul", "Ariana", "Daniela", "Janet", "Erik"]
            };

            function calculateEndDateWithoutWeekends(startDate, duration) {
                let current = new Date(startDate);
                let daysAdded = 0;
                while (daysAdded < duration) {
                    current.setDate(current.getDate() + 1);
                    if (current.getDay() !== 0 && current.getDay() !== 6) {
                        daysAdded++;
                    }
                }
                return current;
            }

            function adjustDateForWeekends(date, isIncreasing) {
                if (isIncreasing) {
                    while (date.getDay() === 0 || date.getDay() === 6) {
                        date.setDate(date.getDate() + 1);
                    }
                } else {
                    while (date.getDay() === 0 || date.getDay() === 6) {
                        date.setDate(date.getDate() - 1);
                    }
                }
                return date;
            }

            function calculateTotalDays(startDate, endDate) {
                let totalDays = 0;
                const current = new Date(startDate);

                while (current <= endDate) {
                    if (current.getDay() !== 0 && current.getDay() !== 6) {
                        totalDays++;
                    }
                    current.setDate(current.getDate() + 1);
                }

                return totalDays;
            }

            const data = [];
            for (let i = 0; i < totalItems; i++) {
                const taskName = "Tablero " + (i + 1) + ": " + options[i];
                const idItem = idItems[i];

                const subTaskName1 = idItem + ".- Aceptación de proyecto";
                const subTaskName2 = idItem + ".- Documentos para aprobación";
                const subTaskName3 = idItem + ".- Aprobación - cliente";
                const subTaskName4 = idItem + ".- Liberación - RIPA";
                const subTaskName5 = idItem + ".- Analizar RIPA";
                const subTaskName6 = idItem + ".- Reporte de fecha RIPA";
                const subTaskName7 = idItem + ".- Liberación - lista";
                const subTaskName8 = idItem + ".- Liberación de WORKFLOW";
                const subTaskName9 = idItem + ".- Analizar lista";
                const subTaskName10 = idItem + ".- Reporte de fecha - lista";
                const subTaskName11 = idItem + ".- Documentos para fabricación";
                const subTaskName12 = idItem + ".- Asignación de rutas";
                const subTaskName13 = idItem + ".- Fabricación";
                const subTaskName14 = idItem + ".- Reporte de pruebas FAT";
                const subTaskName15 = idItem + ".- Reporte de pruebas (Rutina o Dossier)";

                const startDate = calculateEndDateWithoutWeekends(new Date(date[i]), 1);
                const EndDate = calculateEndDateWithoutWeekends(new Date(dateF[i]), 1);

                const AEndDateFixed = calculateEndDateWithoutWeekends(startDate, fixedDurations[subTaskName1] || 1);
                const BEndDateFixed = calculateEndDateWithoutWeekends(AEndDateFixed, fixedDurations[subTaskName2] || 3);
                const CEndDateFixed = calculateEndDateWithoutWeekends(BEndDateFixed, fixedDurations[subTaskName3] || 5);
                const DEndDateFixed = calculateEndDateWithoutWeekends(CEndDateFixed, fixedDurations[subTaskName4] || 2);
                const EEndDateFixed = calculateEndDateWithoutWeekends(DEndDateFixed, fixedDurations[subTaskName5] || 3);
                const FEndDateFixed = calculateEndDateWithoutWeekends(EEndDateFixed, fixedDurations[subTaskName6] || 3);
                const GEndDateFixed = calculateEndDateWithoutWeekends(FEndDateFixed, fixedDurations[subTaskName7] || 6);
                const HEndDateFixed = calculateEndDateWithoutWeekends(GEndDateFixed, fixedDurations[subTaskName8] || 2);
                const IEndDateFixed = calculateEndDateWithoutWeekends(HEndDateFixed, fixedDurations[subTaskName9] || 4);
                const JEndDateFixed = calculateEndDateWithoutWeekends(IEndDateFixed, fixedDurations[subTaskName10] || 4);
                const KEndDateFixed = calculateEndDateWithoutWeekends(JEndDateFixed, fixedDurations[subTaskName11] || 1);
                const LEndDateFixed = calculateEndDateWithoutWeekends(KEndDateFixed, fixedDurations[subTaskName12] || 2);
                const MEndDateFixed = calculateEndDateWithoutWeekends(LEndDateFixed, fixedDurations[subTaskName13] || 1);
                const NEndDateFixed = calculateEndDateWithoutWeekends(MEndDateFixed, fixedDurations[subTaskName14] || 1);
                const ÑEndDateFixed = calculateEndDateWithoutWeekends(NEndDateFixed, fixedDurations[subTaskName15] || 3);

                const AEndDateReal = calculateEndDateWithoutWeekends(startDate, storedDurations[subTaskName1] || 1);
                const BEndDateReal = calculateEndDateWithoutWeekends(AEndDateReal, storedDurations[subTaskName2] || 3);
                const CEndDateReal = calculateEndDateWithoutWeekends(BEndDateReal, storedDurations[subTaskName3] || 5);
                const DEndDateReal = calculateEndDateWithoutWeekends(CEndDateReal, storedDurations[subTaskName4] || 2);
                const EEndDateReal = calculateEndDateWithoutWeekends(DEndDateReal, storedDurations[subTaskName5] || 3);
                const FEndDateReal = calculateEndDateWithoutWeekends(EEndDateReal, storedDurations[subTaskName6] || 3);
                const GEndDateReal = calculateEndDateWithoutWeekends(FEndDateReal, storedDurations[subTaskName7] || 6);
                const HEndDateReal = calculateEndDateWithoutWeekends(GEndDateReal, storedDurations[subTaskName8] || 2);
                const IEndDateReal = calculateEndDateWithoutWeekends(HEndDateReal, storedDurations[subTaskName9] || 4);
                const JEndDateReal = calculateEndDateWithoutWeekends(IEndDateReal, storedDurations[subTaskName10] || 4);
                const KEndDateReal = calculateEndDateWithoutWeekends(JEndDateReal, storedDurations[subTaskName11] || 1);
                const LEndDateReal = calculateEndDateWithoutWeekends(KEndDateReal, storedDurations[subTaskName12] || 2);
                const MEndDateReal = calculateEndDateWithoutWeekends(LEndDateReal, storedDurations[subTaskName13] || 1);
                const NEndDateReal = calculateEndDateWithoutWeekends(MEndDateReal, storedDurations[subTaskName14] || 1);
                const ÑEndDateReal = calculateEndDateWithoutWeekends(NEndDateReal, storedDurations[subTaskName15] || 3);

                const colorClass = "gantt_task_color_" + ((i % 5) + 1);

                data.push(
                    {
                        id: "task" + i,
                        text: taskName,
                        start_date: startDate,
                        end_date: EndDate,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        original_end_date: EndDate
                    },
                    {
                        id: "subtask_0" + i,
                        text: subTaskName1,
                        start_date: startDate,
                        parent: "task" + i,
                        end_date: AEndDateReal,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName1] || 1,
                        originalStartDate: startDate,
                        originalEndDate: AEndDateFixed
                    },
                    {
                        id: "subtask_2" + i,
                        text: subTaskName2,
                        start_date: calculateEndDateWithoutWeekends(AEndDateReal, 0),
                        parent: "task" + i,
                        end_date: BEndDateReal,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName2] || 3,
                        originalStartDate: calculateEndDateWithoutWeekends(AEndDateFixed, 0),
                        originalEndDate: BEndDateFixed
                    },
                    {
                        id: "subtask_3" + i,
                        text: subTaskName3,
                        start_date: calculateEndDateWithoutWeekends(BEndDateReal, 0),
                        parent: "task" + i,
                        end_date: CEndDateReal,
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName3] || 5,
                        originalStartDate: calculateEndDateWithoutWeekends(BEndDateFixed, 0),
                        originalEndDate: CEndDateFixed
                    },
                    {
                        id: "subtask_4" + i,
                        text: subTaskName4,
                        start_date: calculateEndDateWithoutWeekends(CEndDateReal, 0),
                        parent: "task" + i,
                        end_date: DEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName4] || 2,
                        originalStartDate: calculateEndDateWithoutWeekends(CEndDateFixed, 0),
                        originalEndDate: DEndDateFixed
                    },
                    {
                        id: "subtask_5" + i,
                        text: subTaskName5,
                        start_date: calculateEndDateWithoutWeekends(DEndDateReal, 0),
                        parent: "task" + i,
                        end_date: EEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName5] || 3,
                        originalStartDate: calculateEndDateWithoutWeekends(DEndDateFixed, 0),
                        originalEndDate: EEndDateFixed
                    },
                    {
                        id: "subtask_6" + i,
                        text: subTaskName6,
                        start_date: calculateEndDateWithoutWeekends(EEndDateReal, 0),
                        parent: "task" + i,
                        end_date: FEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName6] || 3,
                        originalStartDate: calculateEndDateWithoutWeekends(EEndDateFixed, 0),
                        originalEndDate: FEndDateFixed
                    },
                    {
                        id: "subtask_7" + i,
                        text: subTaskName7,
                        start_date: calculateEndDateWithoutWeekends(FEndDateReal, 0),
                        parent: "task" + i,
                        end_date: GEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName7] || 6,
                        originalStartDate: calculateEndDateWithoutWeekends(FEndDateFixed, 0),
                        originalEndDate: GEndDateFixed
                    },
                    {
                        id: "subtask_8" + i,
                        text: subTaskName8,
                        start_date: calculateEndDateWithoutWeekends(GEndDateReal, 0),
                        parent: "task" + i,
                        end_date: HEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName8] || 2,
                        originalStartDate: calculateEndDateWithoutWeekends(GEndDateFixed, 0),
                        originalEndDate: HEndDateFixed
                    },
                    {
                        id: "subtask_9" + i,
                        text: subTaskName9,
                        start_date: calculateEndDateWithoutWeekends(HEndDateReal, 0),
                        parent: "task" + i,
                        end_date: IEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName9] || 4,
                        originalStartDate: calculateEndDateWithoutWeekends(HEndDateFixed, 0),
                        originalEndDate: IEndDateFixed
                    },
                    {
                        id: "subtask_10" + i,
                        text: subTaskName10,
                        start_date: calculateEndDateWithoutWeekends(IEndDateReal, 0),
                        parent: "task" + i,
                        end_date: JEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName10] || 4,
                        originalStartDate: calculateEndDateWithoutWeekends(IEndDateFixed, 0),
                        originalEndDate: JEndDateFixed
                    },
                    {
                        id: "subtask_11" + i,
                        text: subTaskName11,
                        start_date: calculateEndDateWithoutWeekends(JEndDateReal, 0),
                        parent: "task" + i,
                        end_date: KEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName11] || 1,
                        originalStartDate: calculateEndDateWithoutWeekends(JEndDateFixed, 0),
                        originalEndDate: KEndDateFixed
                    },
                    {
                        id: "subtask_12" + i,
                        text: subTaskName12,
                        start_date: calculateEndDateWithoutWeekends(KEndDateReal, 0),
                        parent: "task" + i,
                        end_date: LEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName12] || 2,
                        originalStartDate: calculateEndDateWithoutWeekends(KEndDateFixed, 0),
                        originalEndDate: LEndDateFixed
                    },
                    {
                        id: "subtask_13" + i,
                        text: subTaskName13,
                        start_date: calculateEndDateWithoutWeekends(LEndDateReal, 0),
                        parent: "task" + i,
                        end_date: MEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName13] || 1,
                        originalStartDate: calculateEndDateWithoutWeekends(LEndDateFixed, 0),
                        originalEndDate: MEndDateFixed
                    },
                    {
                        id: "subtask_14" + i,
                        text: subTaskName14,
                        start_date: calculateEndDateWithoutWeekends(MEndDateReal, 0),
                        parent: "task" + i,
                        end_date: NEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName14] || 1,
                        originalStartDate: calculateEndDateWithoutWeekends(MEndDateFixed, 0),
                        originalEndDate: NEndDateFixed
                    },
                    {
                        id: "subtask_15" + i,
                        text: subTaskName15,
                        start_date: calculateEndDateWithoutWeekends(NEndDateReal, 0),
                        parent: "task" + i,
                        end_date: ÑEndDateReal, 
                        responsible: "",
                        css: colorClass,
                        checklist: [],
                        duration: storedDurations[subTaskName15] || 3,
                        originalStartDate: calculateEndDateWithoutWeekends(NEndDateFixed, 0),
                        originalEndDate: ÑEndDateFixed
                    }
                );
            }

            gantt.config.work_time = true;
            gantt.config.skip_off_time = true;

            gantt.init("gantt_chart");
            gantt.parse({ data });
            gantt.templates.task_class = function(start, end, task) {
                return task.css;
            };

            function updateParentDuration(parentTaskId) {
                if (!gantt.isTaskExists(parentTaskId)) {
                    return;
                }
                const subtasks = gantt.getChildren(parentTaskId);
                let totalDuration = 0;
                subtasks.forEach(subtaskId => {
                    const subtask = gantt.getTask(subtaskId);
                    totalDuration += subtask.duration;
                });
                const parentTask = gantt.getTask(parentTaskId);
                parentTask.duration = totalDuration;
                gantt.refreshTask(parentTaskId);

                const endDate = gantt.calculateEndDate(parentTask.start_date, parentTask.duration);
                endDate.setDate(endDate.getDate() - 1);
                if (endDate.getDay() === 0) {
                    endDate.setDate(endDate.getDate() - 2);
                }
                parentTask.end_date = endDate;
                gantt.refreshTask(parentTaskId);
            }

            const tasks = gantt.getTaskByTime();
            tasks.forEach(task => {
                if (!task.parent) {
                    updateParentDuration(task.id);
                }
            });

            gantt.attachEvent("onGanttRender", function() {
                const tasks = gantt.getTaskByTime();
                tasks.forEach(task => {
                    if (!task.parent) {
                        updateParentDuration(task.id);
                    }
                });

                document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const taskId = this.dataset.taskId;
                        const task = gantt.getTask(taskId);
                        if (this.checked) {
                            task.checklist.push(true);
                        } else {
                            task.checklist = task.checklist.filter(item => item !== true);
                        }
                    });
                });
            });

            gantt.attachEvent("onAfterTaskUpdate", function(taskId, task) {
                const isIncreasing = task.end_date > task.start_date;
                const taskDuration = task.duration;

                storedDurations[task.text] = taskDuration;
                localStorage.setItem(storedDurationsKey, JSON.stringify(storedDurations));

                if (taskId.includes("subtask_0")) {
                    const task2Id = taskId.replace("subtask_0", "subtask_2");
                    const task2 = gantt.getTask(task2Id);
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task2.text] || 3), isIncreasing);
                    if (task2) {
                        task2.start_date = newStartDate;
                        task2.end_date = newEndDate;
                        gantt.refreshTask(task2Id);

                        const task3Id = task2Id.replace("subtask_2", "subtask_3");
                        const task3 = gantt.getTask(task3Id);
                        if (task3) {
                            const task3StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newEndDate, 0), isIncreasing);
                            const task3EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3StartDate, storedDurations[task3.text] || 5), isIncreasing);
                            task3.start_date = task3StartDate;
                            task3.end_date = task3EndDate;
                            gantt.refreshTask(task3Id);
                        }
                    }
                } else if (taskId.includes("subtask_2")) {
                    const task3Id = taskId.replace("subtask_2", "subtask_3");
                    const task3 = gantt.getTask(task3Id);
                    if (task3) {
                        const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                        const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task3.text] || 5), isIncreasing);
                        task3.start_date = newStartDate;
                        task3.end_date = newEndDate;
                        gantt.refreshTask(task3Id);
                    }
                }
                const parentTaskId = gantt.getTask(taskId).parent;
                if (gantt.isTaskExists(parentTaskId)) {
                    updateParentDuration(parentTaskId);
                }
            });

            function checkTaskDates() {
                const tasks = gantt.getTaskByTime();
                tasks.forEach(task => {
                    if (!task.parent) {
                        const parentIdealEndDate = new Date(task.original_end_date);
                        const subtasks = gantt.getChildren(task.id);
                        let isOutOfTime = false;
                        let daysToReduce = 0;

                        if (subtasks.length > 0) {
                            const lastSubtask = gantt.getTask(subtasks[subtasks.length - 1]);
                            const lastSubtaskIdealEndDate = gantt.calculateEndDate(lastSubtask.start_date, lastSubtask.duration);
                            lastSubtaskIdealEndDate.setDate(lastSubtaskIdealEndDate.getDate() - 1);
                            if (parentIdealEndDate < lastSubtaskIdealEndDate) {
                                isOutOfTime = true;
                                daysToReduce = calculateBusinessDaysBetween(parentIdealEndDate, lastSubtaskIdealEndDate);
                            }
                        }

                        const warningText = `Reduce ${daysToReduce} día(s)`;
                        const warningTextStyled = ` <small style='font-size: 0.75em; color: red;'>${warningText}</small>`;
                        
                        task.text = task.text.replace(/ <small style='font-size: 0.75em; color: red;'>Reduce \d+ día\(s\)<\/small>/, "");

                        if (isOutOfTime) {
                            task.text += warningTextStyled;
                        }

                        gantt.refreshTask(task.id);
                    }
                });
            }

            function calculateBusinessDaysBetween(startDate, endDate) {
                let count = 0;
                let currentDate = new Date(startDate);
                while (currentDate < endDate) {
                    const dayOfWeek = currentDate.getDay();
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        count++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                return count;
            }

            gantt.attachEvent("onGanttRender", function() {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskAdd", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskUpdate", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onAfterTaskDelete", function(id, item) {
                checkTaskDates();
            });

            gantt.attachEvent("onLightbox", function(taskId) {
                const select = document.querySelector(".gantt_cal_ltext select");
                const task = gantt.getTask(taskId);

                if (task) {
                    let parentTask = null;
                    gantt.eachTask(function(taskItem) {
                        if (taskItem.id === task.parent) {
                            parentTask = taskItem;
                            return false;
                        }
                    });

                    if (parentTask) {
                        if (parentTask.responsible) {
                            const options = taskResponsibles[parentTask.responsible] || [];
                            select.innerHTML = "";
                            options.forEach(option => {
                                const newOption = document.createElement("option");
                                newOption.value = option;
                                newOption.text = option;
                                select.add(newOption);
                            });
                        } else {
                            select.innerHTML = "";
                            const warningOption = document.createElement("option");
                            warningOption.value = "";
                            warningOption.text = "COLOCAR ÁREA EN TAREA PADRE";
                            select.add(warningOption);
                        }
                    } else {
                        select.innerHTML = "";
                        Object.keys(taskResponsibles).forEach(key => {
                            const newOption = document.createElement("option");
                            newOption.value = key;
                            newOption.text = key;
                            select.add(newOption);
                        });
                    }
                } else {
                    select.innerHTML = "";
                    Object.keys(taskResponsibles).forEach(key => {
                        const newOption = document.createElement("option");
                        newOption.value = key;
                        newOption.text = key;
                        select.add(newOption);
                    });
                }
            });
            gantt.parse({ data });
            gantt.templates.task_class = function(start, end, task) {
                return task.css;
            };
        };




            // SI ALGUNA SUBTAREA ES ACTUALIZADA - SUS FECHAS DE INICIO Y FIN CAMBIARAN: COMO DEPENDENCIAS
            gantt.attachEvent("onAfterTaskUpdate", function(taskId, task) {
            const isIncreasing = task.end_date > task.start_date;
            const taskDuration = task.duration;

            // ARRAY
            storedDurations[task.text] = taskDuration;
            localStorage.setItem(storedDurationsKey, JSON.stringify(storedDurations));

            // Guardar la nueva fecha de inicio y fin en localStorage
            startDates[taskId] = task.start_date;
            endDates[taskId] = task.end_date;
            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));


            //SI LA SUBTAREA ACTUALIZADA ES LA 1
            if (taskId.includes("subtask_0")) {
                            
                const task2Id = taskId.replace("subtask_0", "subtask_2");
                const task2 = gantt.getTask(task2Id);
                const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task2.text] || 3), isIncreasing);
                if (task2) {
                    task2.start_date = newStartDate;
                    task2.end_date = newEndDate;
                    gantt.refreshTask(task2Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task2Id] = task2.start_date;
                    endDates[task2Id] = task2.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                    const task3Id = task2Id.replace("subtask_2", "subtask_3");
                    const task3 = gantt.getTask(task3Id);
                    if (task3) {
                        const task3StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newEndDate, 0), isIncreasing);
                        const task3EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3StartDate, storedDurations[task3.text] || 5), isIncreasing);
                        task3.start_date = task3StartDate;
                        task3.end_date = task3EndDate;
                        gantt.refreshTask(task3Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task3Id] = task3.start_date;
                        endDates[task3Id] = task3.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                        const task4Id = task3Id.replace("subtask_3", "subtask_4");
                        const task4 = gantt.getTask(task4Id);
                        if (task4) {
                            const task4StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3EndDate, 0), isIncreasing);
                            const task4EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4StartDate, storedDurations[task4.text] || 2), isIncreasing);
                            task4.start_date = task4StartDate;
                            task4.end_date = task4EndDate;
                            gantt.refreshTask(task4Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task4Id] = task4.start_date;
                            endDates[task4Id] = task4.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                            const task5Id = task4Id.replace("subtask_4", "subtask_5");
                            const task5 = gantt.getTask(task5Id);
                            if (task5) {
                                const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4EndDate, 0), isIncreasing);
                                const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                                task5.start_date = task5StartDate;
                                task5.end_date = task5EndDate;
                                gantt.refreshTask(task5Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task5Id] = task5.start_date;
                                endDates[task5Id] = task5.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                                const task6Id = task5Id.replace("subtask_5", "subtask_6");
                                const task6 = gantt.getTask(task6Id);
                                if (task6) {
                                    const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5EndDate, 0), isIncreasing);
                                    const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                                    task6.start_date = task6StartDate;
                                    task6.end_date = task6EndDate;
                                    gantt.refreshTask(task6Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task6Id] = task6.start_date;
                                    endDates[task6Id] = task6.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    
                                    const task7Id = task6Id.replace("subtask_6", "subtask_7");
                                    const task7 = gantt.getTask(task7Id);
                                    if (task7) {
                                        const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6EndDate, 0), isIncreasing);
                                        const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                        task7.start_date = task7StartDate;
                                        task7.end_date = task7EndDate;
                                        gantt.refreshTask(task7Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task7Id] = task7.start_date;
                                        endDates[task7Id] = task7.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                        const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                        const task8 = gantt.getTask(task8Id);
                                        if (task8) {
                                            const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7EndDate, 0), isIncreasing);
                                            const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                            task8.start_date = task8StartDate;
                                            task8.end_date = task8EndDate;
                                            gantt.refreshTask(task8Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task8Id] = task8.start_date;
                                            endDates[task8Id] = task8.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                            const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                            const task9 =gantt.getTask(task9Id);
                                            if (task9) {
                                                const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8EndDate, 0), isIncreasing);
                                                const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                                task9.start_date = task9StartDate;
                                                task9.end_date = task9EndDate;
                                                gantt.refreshTask(task9Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task9Id] = task9.start_date;
                                                endDates[task9Id] = task9.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                                const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                                const task10 = gantt.getTask(task10Id);
                                                if (task10) {
                                                    const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9EndDate, 0), isIncreasing);
                                                    const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                                    task10.start_date = task10StartDate;
                                                    task10.end_date = task10EndDate;
                                                    gantt.refreshTask(task10Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task10Id] = task10.start_date;
                                                    endDates[task10Id] = task10.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    
                                                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                                    const task11 = gantt.getTask(task11Id);
                                                    if (task11) {
                                                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10EndDate, 0), isIncreasing);
                                                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                        task11.start_date = task11StartDate;
                                                        task11.end_date = task11EndDate;
                                                        gantt.refreshTask(task11Id);
                                                        // Guardar las nuevas fechas en localStorage
                                                        startDates[task11Id] = task11.start_date;
                                                        endDates[task11Id] = task11.end_date;
                                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                        const task12 = gantt.getTask(task12Id);
                                                        if (task12) {
                                                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11EndDate, 0), isIncreasing);
                                                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                            task12.start_date = task12StartDate;
                                                            task12.end_date = task12EndDate;
                                                            gantt.refreshTask(task12Id);
                                                            // Guardar las nuevas fechas en localStorage
                                                            startDates[task12Id] = task12.start_date;
                                                            endDates[task12Id] = task12.end_date;
                                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 2
            else if (taskId.includes("subtask_2")) {
            const task3Id = taskId.replace("subtask_2", "subtask_3");
            const task3 = gantt.getTask(task3Id);
            if (task3) {
                const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task3.text] || 5), isIncreasing);
                task3.start_date = newStartDate;
                task3.end_date = newEndDate;
                gantt.refreshTask(task3Id);
                // Guardar las nuevas fechas en localStorage
                startDates[task3Id] = task3.start_date;
                endDates[task3Id] = task3.end_date;
                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));


                const task4Id = task3Id.replace("subtask_3", "subtask_4");
                const task4 = gantt.getTask(task4Id);
                if (task4) {
                    const task4StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task3.end_date, 0), isIncreasing);
                    const task4EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4StartDate, storedDurations[task4.text] || 2), isIncreasing);
                    task4.start_date = task4StartDate;
                    task4.end_date = task4EndDate;
                    gantt.refreshTask(task4Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task4Id] = task4.start_date;
                    endDates[task4Id] = task4.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task5Id = task4Id.replace("subtask_4", "subtask_5");
                    const task5 = gantt.getTask(task5Id);
                    if (task5) {
                        const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4.end_date, 0), isIncreasing);
                        const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                        task5.start_date = task5StartDate;
                        task5.end_date = task5EndDate;
                        gantt.refreshTask(task5Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task5Id] = task5.start_date;
                        endDates[task5Id] = task5.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task6Id = task5Id.replace("subtask_5", "subtask_6");
                        const task6 = gantt.getTask(task6Id);
                        if (task6) {
                            const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                            const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                            task6.start_date = task6StartDate;
                            task6.end_date = task6EndDate;
                            gantt.refreshTask(task6Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task6Id] = task6.start_date;
                            endDates[task6Id] = task6.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task7Id = task6Id.replace("subtask_6", "subtask_7");
                            const task7 = gantt.getTask(task7Id);
                            if (task7) {
                                const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                                const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                task7.start_date = task7StartDate;
                                task7.end_date = task7EndDate;
                                gantt.refreshTask(task7Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task7Id] = task7.start_date;
                                endDates[task7Id] = task7.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                const task8 = gantt.getTask(task8Id);
                                if (task8) {
                                    const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                    const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                    task8.start_date = task8StartDate;
                                    task8.end_date = task8EndDate;
                                    gantt.refreshTask(task8Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task8Id] = task8.start_date;
                                    endDates[task8Id] = task8.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                    const task9 = gantt.getTask(task9Id);
                                    if (task9) {
                                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                        task9.start_date = task9StartDate;
                                        task9.end_date = task9EndDate;
                                        gantt.refreshTask(task9Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task9Id] = task9.start_date;
                                        endDates[task9Id] = task9.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                        const task10 = gantt.getTask(task10Id);
                                        if (task10) {
                                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                            task10.start_date = task10StartDate;
                                            task10.end_date = task10EndDate;
                                            gantt.refreshTask(task10Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task10Id] = task10.start_date;
                                            endDates[task10Id] = task10.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                            const task11 = gantt.getTask(task11Id);
                                            if (task11) {
                                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                task11.start_date = task11StartDate;
                                                task11.end_date = task11EndDate;
                                                gantt.refreshTask(task11Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task11Id] = task11.start_date;
                                                endDates[task11Id] = task11.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                const task12 = gantt.getTask(task12Id);
                                                if (task12) {
                                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                    task12.start_date = task12StartDate;
                                                    task12.end_date = task12EndDate;
                                                    gantt.refreshTask(task12Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task12Id] = task12.start_date;
                                                    endDates[task12Id] = task12.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 3
            else if (taskId.includes("subtask_3")) {
                
                const task4Id = taskId.replace("subtask_3", "subtask_4");
                const task4 = gantt.getTask(task4Id);
                if (task4) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task4.text] || 2), isIncreasing);
                    task4.start_date = newStartDate;
                    task4.end_date = newEndDate;
                    gantt.refreshTask(task4Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task4Id] = task4.start_date;
                    endDates[task4Id] = task4.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task5Id = task4Id.replace("subtask_4", "subtask_5");
                    const task5 = gantt.getTask(task5Id);
                    if (task5) {
                        const task5StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task4.end_date, 0), isIncreasing);
                        const task5EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5StartDate, storedDurations[task5.text] || 3), isIncreasing);
                        task5.start_date = task5StartDate;
                        task5.end_date = task5EndDate;
                        gantt.refreshTask(task5Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task5Id] = task5.start_date;
                        endDates[task5Id] = task5.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task6Id = task5Id.replace("subtask_5", "subtask_6");
                        const task6 = gantt.getTask(task6Id);
                        if (task6) {
                            const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                            const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                            task6.start_date = task6StartDate;
                            task6.end_date = task6EndDate;
                            gantt.refreshTask(task6Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task6Id] = task6.start_date;
                            endDates[task6Id] = task6.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task7Id = task6Id.replace("subtask_6", "subtask_7");
                            const task7 = gantt.getTask(task7Id);
                            if (task7) {
                                const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                                const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                                task7.start_date = task7StartDate;
                                task7.end_date = task7EndDate;
                                gantt.refreshTask(task7Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task7Id] = task7.start_date;
                                endDates[task7Id] = task7.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task8Id = task7Id.replace("subtask_7", "subtask_8");
                                const task8 = gantt.getTask(task8Id);
                                if (task8) {
                                    const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                    const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                    task8.start_date = task8StartDate;
                                    task8.end_date = task8EndDate;
                                    gantt.refreshTask(task8Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task8Id] = task8.start_date;
                                    endDates[task8Id] = task8.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                    const task9 = gantt.getTask(task9Id);
                                    if (task9) {
                                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                        task9.start_date = task9StartDate;
                                        task9.end_date = task9EndDate;
                                        gantt.refreshTask(task9Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task9Id] = task9.start_date;
                                        endDates[task9Id] = task9.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                        const task10 = gantt.getTask(task10Id);
                                        if (task10) {
                                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                            task10.start_date = task10StartDate;
                                            task10.end_date = task10EndDate;
                                            gantt.refreshTask(task10Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task10Id] = task10.start_date;
                                            endDates[task10Id] = task10.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                            const task11 = gantt.getTask(task11Id);
                                            if (task11) {
                                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                                task11.start_date = task11StartDate;
                                                task11.end_date = task11EndDate;
                                                gantt.refreshTask(task11Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task11Id] = task11.start_date;
                                                endDates[task11Id] = task11.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                                
                                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                                const task12 = gantt.getTask(task12Id);
                                                if (task12) {
                                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                    task12.start_date = task12StartDate;
                                                    task12.end_date = task12EndDate;
                                                    gantt.refreshTask(task12Id);
                                                    // Guardar las nuevas fechas en localStorage
                                                    startDates[task12Id] = task12.start_date;
                                                    endDates[task12Id] = task12.end_date;
                                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));  
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 4
            else if (taskId.includes("subtask_4")) {

                const task5Id = taskId.replace("subtask_4", "subtask_5");
                const task5 = gantt.getTask(task5Id);
                if (task5) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task5.text] || 3), isIncreasing);
                    task5.start_date = newStartDate;
                    task5.end_date = newEndDate;
                    gantt.refreshTask(task5Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task5Id] = task5.start_date;
                    endDates[task5Id] = task5.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task6Id = task5Id.replace("subtask_5", "subtask_6");
                    const task6 = gantt.getTask(task6Id);
                    if (task6) {
                        const task6StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task5.end_date, 0), isIncreasing);
                        const task6EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6StartDate, storedDurations[task6.text] || 3), isIncreasing);
                        task6.start_date = task6StartDate;
                        task6.end_date = task6EndDate;
                        gantt.refreshTask(task6Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task6Id] = task6.start_date;
                        endDates[task6Id] = task6.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task7Id = task6Id.replace("subtask_6", "subtask_7");
                        const task7 = gantt.getTask(task7Id);
                        if (task7) {
                            const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                            const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                            task7.start_date = task7StartDate;
                            task7.end_date = task7EndDate;
                            gantt.refreshTask(task7Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task7Id] = task7.start_date;
                            endDates[task7Id] = task7.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task8Id = task7Id.replace("subtask_7", "subtask_8");
                            const task8 = gantt.getTask(task8Id);
                            if (task8) {
                                const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                                const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                                task8.start_date = task8StartDate;
                                task8.end_date = task8EndDate;
                                gantt.refreshTask(task8Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task8Id] = task8.start_date;
                                endDates[task8Id] = task8.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task9Id = task8Id.replace("subtask_8", "subtask_9");
                                const task9 = gantt.getTask(task9Id);
                                if (task9) {
                                    const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                    const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                    task9.start_date = task9StartDate;
                                    task9.end_date = task9EndDate;
                                    gantt.refreshTask(task9Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task9Id] = task9.start_date;
                                    endDates[task9Id] = task9.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                    const task10 = gantt.getTask(task10Id);
                                    if (task10) {
                                        const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                        const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                        task10.start_date = task10StartDate;
                                        task10.end_date = task10EndDate;
                                        gantt.refreshTask(task10Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task10Id] = task10.start_date;
                                        endDates[task10Id] = task10.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                        const task11 = gantt.getTask(task11Id);
                                        if (task11) {
                                            const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                            const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                            task11.start_date = task11StartDate;
                                            task11.end_date = task11EndDate;
                                            gantt.refreshTask(task11Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task11Id] = task11.start_date;
                                            endDates[task11Id] = task11.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                            const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                            const task12 = gantt.getTask(task12Id);
                                            if (task12) {
                                                const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                                const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                                task12.start_date = task12StartDate;
                                                task12.end_date = task12EndDate;
                                                gantt.refreshTask(task12Id);
                                                // Guardar las nuevas fechas en localStorage
                                                startDates[task12Id] = task12.start_date;
                                                endDates[task12Id] = task12.end_date;
                                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 5
            else if (taskId.includes("subtask_5")) {

                const task6Id = taskId.replace("subtask_5", "subtask_6");
                const task6 = gantt.getTask(task6Id);
                if (task6) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task6.text] || 3), isIncreasing);
                    task6.start_date = newStartDate;
                    task6.end_date = newEndDate;
                    gantt.refreshTask(task6Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task6Id] = task6.start_date;
                    endDates[task6Id] = task6.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task7Id = task6Id.replace("subtask_6", "subtask_7");
                    const task7 = gantt.getTask(task7Id);
                    if (task7) {
                        const task7StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task6.end_date, 0), isIncreasing);
                        const task7EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7StartDate, storedDurations[task7.text] || 6), isIncreasing);
                        task7.start_date = task7StartDate;
                        task7.end_date = task7EndDate;
                        gantt.refreshTask(task7Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task7Id] = task7.start_date;
                        endDates[task7Id] = task7.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task8Id = task7Id.replace("subtask_7", "subtask_8");
                        const task8 = gantt.getTask(task8Id);
                        if (task8) {
                            const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                            const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                            task8.start_date = task8StartDate;
                            task8.end_date = task8EndDate;
                            gantt.refreshTask(task8Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task8Id] = task8.start_date;
                            endDates[task8Id] = task8.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task9Id = task8Id.replace("subtask_8", "subtask_9");
                            const task9 = gantt.getTask(task9Id);
                            if (task9) {
                                const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                                const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                                task9.start_date = task9StartDate;
                                task9.end_date = task9EndDate;
                                gantt.refreshTask(task9Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task9Id] = task9.start_date;
                                endDates[task9Id] = task9.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task10Id = task9Id.replace("subtask_9", "subtask_10");
                                const task10 = gantt.getTask(task10Id);
                                if (task10) {
                                    const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                    const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                    task10.start_date = task10StartDate;
                                    task10.end_date = task10EndDate;
                                    gantt.refreshTask(task10Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task10Id] = task10.start_date;
                                    endDates[task10Id] = task10.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                    const task11 = gantt.getTask(task11Id);
                                    if (task11) {
                                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                        task11.start_date = task11StartDate;
                                        task11.end_date = task11EndDate;
                                        gantt.refreshTask(task11Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task11Id] = task11.start_date;
                                        endDates[task11Id] = task11.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                        const task12 = gantt.getTask(task12Id);
                                        if (task12) {
                                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                            task12.start_date = task12StartDate;
                                            task12.end_date = task12EndDate;
                                            gantt.refreshTask(task12Id);
                                            // Guardar las nuevas fechas en localStorage
                                            startDates[task12Id] = task12.start_date;
                                            endDates[task12Id] = task12.end_date;
                                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                        }
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 6 
            else if (taskId.includes("subtask_6")) {

                const task7Id = taskId.replace("subtask_6", "subtask_7");
                const task7 = gantt.getTask(task7Id);
                if (task7) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task7.text] || 6), isIncreasing);
                    task7.start_date = newStartDate;
                    task7.end_date = newEndDate;
                    gantt.refreshTask(task7Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task7Id] = task7.start_date;
                    endDates[task7Id] = task7.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task8Id = task7Id.replace("subtask_7", "subtask_8");
                    const task8 = gantt.getTask(task8Id);
                    if (task8) {
                        const task8StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task7.end_date, 0), isIncreasing);
                        const task8EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8StartDate, storedDurations[task8.text] || 2), isIncreasing);
                        task8.start_date = task8StartDate;
                        task8.end_date = task8EndDate;
                        gantt.refreshTask(task8Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task8Id] = task8.start_date;
                        endDates[task8Id] = task8.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task9Id = task8Id.replace("subtask_8", "subtask_9");
                        const task9 = gantt.getTask(task9Id);
                        if (task9) {
                            const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                            const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                            task9.start_date = task9StartDate;
                            task9.end_date = task9EndDate;
                            gantt.refreshTask(task9Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task9Id] = task9.start_date;
                            endDates[task9Id] = task9.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task10Id = task9Id.replace("subtask_9", "subtask_10");
                            const task10 = gantt.getTask(task10Id);
                            if (task10) {
                                const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                                const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                                task10.start_date = task10StartDate;
                                task10.end_date = task10EndDate;
                                gantt.refreshTask(task10Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task10Id] = task10.start_date;
                                endDates[task10Id] = task10.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task11Id = task10Id.replace("subtask_10", "subtask_11");
                                const task11 = gantt.getTask(task11Id);
                                if (task11) {
                                    const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                    const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                    task11.start_date = task11StartDate;
                                    task11.end_date = task11EndDate;
                                    gantt.refreshTask(task11Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task11Id] = task11.start_date;
                                    endDates[task11Id] = task11.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                    const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                    const task12 = gantt.getTask(task12Id);
                                    if (task12) {
                                        const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                        const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                        task12.start_date = task12StartDate;
                                        task12.end_date = task12EndDate;
                                        gantt.refreshTask(task12Id);
                                        // Guardar las nuevas fechas en localStorage
                                        startDates[task12Id] = task12.start_date;
                                        endDates[task12Id] = task12.end_date;
                                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                    }
                                }
                            }
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 7    
            else if (taskId.includes("subtask_7")) {

                const task8Id = taskId.replace("subtask_7", "subtask_8");
                const task8 = gantt.getTask(task8Id);
                if (task8) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task8.text] || 2), isIncreasing);
                    task8.start_date = newStartDate;
                    task8.end_date = newEndDate;
                    gantt.refreshTask(task8Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task8Id] = task8.start_date;
                    endDates[task8Id] = task8.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task9Id = task8Id.replace("subtask_8", "subtask_9");
                    const task9 = gantt.getTask(task9Id);
                    if (task9) {
                        const task9StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task8.end_date, 0), isIncreasing);
                        const task9EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9StartDate, storedDurations[task9.text] || 4), isIncreasing);
                        task9.start_date = task9StartDate;
                        task9.end_date = task9EndDate;
                        gantt.refreshTask(task9Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task9Id] = task9.start_date;
                        endDates[task9Id] = task9.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task10Id = task9Id.replace("subtask_9", "subtask_10");
                        const task10 = gantt.getTask(task10Id);
                        if (task10) {
                            const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                            const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                            task10.start_date = task10StartDate;
                            task10.end_date = task10EndDate;
                            gantt.refreshTask(task10Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task10Id] = task10.start_date;
                            endDates[task10Id] = task10.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task11Id = task10Id.replace("subtask_10", "subtask_11");
                            const task11 = gantt.getTask(task11Id);
                            if (task11) {
                                const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                                const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                                task11.start_date = task11StartDate;
                                task11.end_date = task11EndDate;
                                gantt.refreshTask(task11Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task11Id] = task11.start_date;
                                endDates[task11Id] = task11.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                                const task12Id = task11Id.replace("subtask_11", "subtask_12");
                                const task12 = gantt.getTask(task12Id);
                                if (task12) {
                                    const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                    const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                    task12.start_date = task12StartDate;
                                    task12.end_date = task12EndDate;
                                    gantt.refreshTask(task12Id);
                                    // Guardar las nuevas fechas en localStorage
                                    startDates[task12Id] = task12.start_date;
                                    endDates[task12Id] = task12.end_date;
                                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                                }
                            }
                        }
                    }
                } 
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 8 
            else if (taskId.includes("subtask_8")) {

                const task9Id = taskId.replace("subtask_8", "subtask_9");
                const task9 = gantt.getTask(task9Id);
                if (task9) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task9.text] || 4), isIncreasing);
                    task9.start_date = newStartDate;
                    task9.end_date = newEndDate;
                    gantt.refreshTask(task9Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task9Id] = task9.start_date;
                    endDates[task9Id] = task9.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task10Id = task9Id.replace("subtask_9", "subtask_10");
                    const task10 = gantt.getTask(task10Id);
                    if (task10) {
                        const task10StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task9.end_date, 0), isIncreasing);
                        const task10EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10StartDate, storedDurations[task10.text] || 4), isIncreasing);
                        task10.start_date = task10StartDate;
                        task10.end_date = task10EndDate;
                        gantt.refreshTask(task10Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task10Id] = task10.start_date;
                        endDates[task10Id] = task10.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                        

                        const task11Id = task10Id.replace("subtask_10", "subtask_11");
                        const task11 = gantt.getTask(task11Id);
                        if (task11) {
                            const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                            const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                            task11.start_date = task11StartDate;
                            task11.end_date = task11EndDate;
                            gantt.refreshTask(task11Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task11Id] = task11.start_date;
                            endDates[task11Id] = task11.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                            const task12Id = task11Id.replace("subtask_11", "subtask_12");
                            const task12 = gantt.getTask(task12Id);
                            if (task12) {
                                const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                                const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                                task12.start_date = task12StartDate;
                                task12.end_date = task12EndDate;
                                gantt.refreshTask(task12Id);
                                // Guardar las nuevas fechas en localStorage
                                startDates[task12Id] = task12.start_date;
                                endDates[task12Id] = task12.end_date;
                                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                            }
                        }
                    }
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 9 
            else if (taskId.includes("subtask_9")) {

                const task10Id = taskId.replace("subtask_9", "subtask_10");
                const task10 = gantt.getTask(task10Id);
                if (task10) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task10.text] || 4), isIncreasing);
                    task10.start_date = newStartDate;
                    task10.end_date = newEndDate;
                    gantt.refreshTask(task10Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task10Id] = task10.start_date;
                    endDates[task10Id] = task10.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task11Id = task10Id.replace("subtask_10", "subtask_11");
                    const task11 = gantt.getTask(task11Id);
                    if (task11) {
                        const task11StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task10.end_date, 0), isIncreasing);
                        const task11EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11StartDate, storedDurations[task11.text] || 1), isIncreasing);
                        task11.start_date = task11StartDate;
                        task11.end_date = task11EndDate;
                        gantt.refreshTask(task11Id);    
                        // Guardar las nuevas fechas en localStorage
                        startDates[task11Id] = task11.start_date;
                        endDates[task11Id] = task11.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task12Id = task11Id.replace("subtask_11", "subtask_12");
                        const task12 = gantt.getTask(task12Id);
                        if (task12) {
                            const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                            const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                            task12.start_date = task12StartDate;
                            task12.end_date = task12EndDate;
                            gantt.refreshTask(task12Id);
                            // Guardar las nuevas fechas en localStorage
                            startDates[task12Id] = task12.start_date;
                            endDates[task12Id] = task12.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                        }
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 10    
            else if (taskId.includes("subtask_10")) {

                const task11Id = taskId.replace("subtask_10", "subtask_11");
                const task11 = gantt.getTask(task11Id);
                if (task11) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task11.text] || 1), isIncreasing);
                    task11.start_date = newStartDate;
                    task11.end_date = newEndDate;
                    gantt.refreshTask(task11Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task11Id] = task11.start_date;
                    endDates[task11Id] = task11.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task12Id = task11Id.replace("subtask_11", "subtask_12");
                    const task12 = gantt.getTask(task12Id);
                    if (task12) {
                        const task12StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task11.end_date, 0), isIncreasing);
                        const task12EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task12StartDate, storedDurations[task12.text] || 2), isIncreasing);
                        task12.start_date = task12StartDate;
                        task12.end_date = task12EndDate;
                        gantt.refreshTask(task12Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task12Id] = task12.start_date;
                        endDates[task12Id] = task12.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    }
                } 
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 11
            else if (taskId.includes("subtask_11")) {

                const task12Id = taskId.replace("subtask_11", "subtask_12");
                const task12 = gantt.getTask(task12Id);
                if (task12) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task12.text] || 2), isIncreasing);
                    task12.start_date = newStartDate;
                    task12.end_date = newEndDate;
                    gantt.refreshTask(task12Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task12Id] = task12.start_date;
                    endDates[task12Id] = task12.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 12
            else if (taskId.includes("subtask_12")) {

            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 13
            else if (taskId.includes("subtask_13")) {

                const task14Id = taskId.replace("subtask_13", "subtask_14");
                const task14 = gantt.getTask(task14Id);
                if (task14) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task14.text] || 1), isIncreasing);
                    task14.start_date = newStartDate;
                    task14.end_date = newEndDate;
                    gantt.refreshTask(task14Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task14Id] = task14.start_date;
                    endDates[task14Id] = task14.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                    const task15Id = task14Id.replace("subtask_14", "subtask_15");
                    const task15 = gantt.getTask(task15Id);
                    if (task15) {
                        const task15StartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task14.end_date, 0), isIncreasing);
                        const task15EndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task15StartDate, storedDurations[task15.text] || 3), isIncreasing);
                        task15.start_date = task15StartDate;
                        task15.end_date = task15EndDate;
                        gantt.refreshTask(task15Id);
                        // Guardar las nuevas fechas en localStorage
                        startDates[task15Id] = task15.start_date;
                        endDates[task15Id] = task15.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                    }
                }
            } 
            //SI LA SUBTAREA ACTUALIZADA ES LA 14
            else if (taskId.includes("subtask_14")) {

                const task15Id = taskId.replace("subtask_14", "subtask_15");
                const task15 = gantt.getTask(task15Id);
                if (task15) {
                    const newStartDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(task.end_date, 0), isIncreasing);
                    const newEndDate = adjustDateForWeekends(calculateEndDateWithoutWeekends(newStartDate, storedDurations[task15.text] || 3), isIncreasing);
                    task15.start_date = newStartDate;
                    task15.end_date = newEndDate;
                    gantt.refreshTask(task15Id);
                    // Guardar las nuevas fechas en localStorage
                    startDates[task15Id] = task15.start_date;
                    endDates[task15Id] = task15.end_date;
                    localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                    localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                }
            }
            //SI LA SUBTAREA ACTUALIZADA ES LA 15
            else if (taskId.includes("subtask_15")) {
                            
            }
                const parentTaskId = gantt.getTask(taskId).parent;
                    if (gantt.isTaskExists(parentTaskId)) {
                    updateParentDuration(parentTaskId);
                    }

            });
















                // SI ALGUNA SUBTAREA ES ACTUALIZADA - SUS FECHAS DE INICIO Y FIN CAMBIARAN: COMO DEPENDENCIAS
                gantt.attachEvent("onAfterTaskUpdate", function(taskId, task) {
                const isIncreasing = task.end_date > task.start_date;
                const taskDuration = task.duration;

                storedDurations[task.text] = taskDuration;
                localStorage.setItem(storedDurationsKey, JSON.stringify(storedDurations));

                // Guardar la nueva fecha de inicio y fin en localStorage
                startDates[taskId] = task.start_date;
                endDates[taskId] = task.end_date;
                localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                if (taskId.includes("subtask_3")) {
                    const task2Id = taskId.replace("subtask_3", "subtask_2");
                    const task2 = gantt.getTask(task2Id);
                    if (task2) {
                        const task2Duration = storedDurations[task2.text] || 3;

                        // Restar la duración de subtask_2 de la fecha de inicio de subtask_3 para obtener la nueva fecha de inicio de subtask_2
                        const newTask2StartDate = subtractBusinessDays(new Date(task.start_date), task2Duration);

                        // Sumar la duración a la nueva fecha de inicio de subtask_2 para obtener la nueva fecha de fin de subtask_2
                        const newTask2EndDate = new Date(newTask2StartDate);
                        newTask2EndDate.setDate(newTask2EndDate.getDate() + task2Duration);

                        task2.start_date = adjustDateForWeekends(newTask2StartDate, isIncreasing);
                        task2.end_date = adjustDateForWeekends(newTask2EndDate, isIncreasing);
                        gantt.refreshTask(task2Id);

                        // Guardar las nuevas fechas en localStorage para subtask_2
                        startDates[task2Id] = task2.start_date;
                        endDates[task2Id] = task2.end_date;
                        localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                        localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));

                        const task0Id = taskId.replace("subtask_3", "subtask_0");
                        const task0 = gantt.getTask(task0Id);
                        if (task0) {
                            const task0Duration = storedDurations[task0.text] || 1;

                            // Restar la duración de subtask_0 de la fecha de inicio de subtask_2 para obtener la nueva fecha de inicio de subtask_0
                            const newTask0StartDate = subtractBusinessDays(new Date(task2.start_date), task0Duration);

                            // Sumar la duración a la nueva fecha de inicio de subtask_0 para obtener la nueva fecha de fin de subtask_0
                            const newTask0EndDate = new Date(newTask0StartDate);
                            newTask0EndDate.setDate(newTask0EndDate.getDate() + task0Duration);

                            task0.start_date = adjustDateForWeekends(newTask0StartDate, isIncreasing);
                            task0.end_date = adjustDateForWeekends(newTask0EndDate, isIncreasing);
                            gantt.refreshTask(task0Id);

                            // Guardar las nuevas fechas en localStorage para subtask_0
                            startDates[task0Id] = task0.start_date;
                            endDates[task0Id] = task0.end_date;
                            localStorage.setItem(storedStartDatesKey, JSON.stringify(startDates));
                            localStorage.setItem(storedEndDatesKey, JSON.stringify(endDates));
                        }
                    }
                }
            });

            function subtractBusinessDays(date, days) {
                let result = new Date(date);
                let day = result.getDay();
                while (days > 0) {
                    result.setDate(result.getDate() - 1);
                    day = result.getDay();
                    // Skip weekends
                    if (day !== 0 && day !== 6) {
                        days--;
                    }
                }
                return result;
            }

    </script>
</body>
</html>


