<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="Pagina.css">
    <link rel="stylesheet" href="Boton.css">
    <title>WEG - AUTOMATIZACIÓN</title>
    <script src="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.js"></script>
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/gantt/edge/dhtmlxgantt.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .form-fields-container {
            display: flex;
        }
        #projectForm {
            overflow: auto;
        }
        .tablero-section {
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .tablero-section .form-field select,
        .tablero-section .form-field input {
            width: 130px;
            height: 30px;
            padding: 5px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .tablero-section .form-field input[name^="columna-id-"],
        .tablero-section .form-field input[name^="item-id-"] {
            width: 145px;
        }
        .small-image {
            width: 90px; /* Cambia este valor según el tamaño que desees */
            height: auto; /* Mantiene la proporción de la imagen */
        }

        .absolute-image {
            position: absolute;
            top: 95vh; /* Ajusta este valor para mover la imagen verticalmente */
            left: 187vh; /* Ajusta este valor para mover la imagen horizontalmente */
            width: 150px; /* Ajusta este valor para cambiar el tamaño de la imagen */
            height: auto; /* Mantiene la proporción de la imagen */
        }
    
    </style>
</head>
<body>
<div class="header">
    <img src="download.png" alt="Imagen" class="small-image">
    <div class="logo">AUTOMATIZACIÓN</div>
    <img src="LOGO FINAL.gif" alt="Imagen" class="absolute-image">
    <div class="greeting">Bueno dias, ¿Que puedo hacer por ti el dia de hoy?</div>
    <div class="search-container">
        <img src="B.png" alt="Search Icon" class="search-icon" style="width: 20px; height: 20px;">          
        <input type="text" placeholder="Buscar proyecto..." oninput="searchProjects()">
    </div>
</div>
<div class="main-container">
    <div id="menu" class="container1">
        <div class="Titulo">MENU DE OPCIONES</div>
        <div class="menu-item" onclick="showProjectbycliente()">AGREGAR PROYECTO</div>
    </div>
    <div id="elementos" class="container">
        <button type="button" class="s" onclick="processPapa()">VER TODOS LOS PROYECTOS - EN MANTENIMIENTO</button>
        <div id="GraficaP" class="container">
            <div class="grafico"></div>
        </div>
        <div id="Ava1" class="container">
            <div class="Comentario..">COMPLETADAS</div>
        </div>
        <div id="Ava2" class="container">
            <div class="Comentario..">AVANCE IDEAL</div>
        </div>
        <div id="Atra" class="container">
            <div class="Comentario..">AVANCE REAL</div>
        </div>
    </div>
    <div id="projectsContainer" class="project-container">
        <div class="Des">PROYECTOS POR CLIENTES: "<span id="projectCount">0</span> Proyectos"</div>
    </div>
</div>


<div class="project-creation-form" id="projectForm">
    
    <div class="form-header"></div>
    <form onsubmit="addProject(event)">
        <div class="form-field">
            <label for="clientName">CLIENTE</label>
            <input type="text" id="clientName" name="clientName">
        </div>
        <div class="form-field">
            <label for="client-order">ORDEN DE VENTA</label>
            <input type="text" id="clientOrder" name="clientOrder">
        </div>
        <div class="form-field">
            <label for="totalItems">NUMERO DE TABLEROS</label>
            <input type="number" id="totalItems" min="1" max="10" oninput="addItemField(this.value)" name="totalItems">
        </div>
        <div id="item-fields"></div>
        <div class="form-buttons">
            <button type="submit" onclick="addProject()">ACEPTAR</button>
            <button type="reset" onclick="clearForm()">BORRAR</button>
            <span onclick="closeForm()" class="close-btn">x</span>
        </div>
    </form>
</div>

<script>
    function addItemField(itemCount) {
        const container = document.getElementById('item-fields');
        container.innerHTML = '';
  
        for (let i = 1; i <= itemCount; i++) {
            const section = document.createElement('div');
            section.classList.add('tablero-section');
  
            const title = document.createElement('h6');
            title.textContent = `Tablero ${i}`;
            section.appendChild(title);
  
            const formFieldsContainer = document.createElement('div');
            formFieldsContainer.classList.add('form-fields-container');
  
            // Campo de opción
            const divOpcion = document.createElement('div');
            divOpcion.classList.add('form-field');
  
            const labelOpcion = document.createElement('h6');
            labelOpcion.textContent = `Opción:`;
            divOpcion.appendChild(labelOpcion);
  
            const opcion = document.createElement('select');
            opcion.name = `item-opcion-${i}`;
            opcion.id = `Opcion-${i}`;
            opcion.innerHTML = `<option value="ESP.">ESP.</option>
                                   <option value="CCM">CCM</option>
                                   <option value="TDW">TDW</option>
                                   <option value="TABLERO DE CONTROL">TABLERO DE CONTROL</option>
                                   <option value="ASW">ASW</option>
                                   <option value="ACFW">ACFW</option>
                                   <option value="BCRW">BCRW</option>
                                   <option value="BCAW">BCAW</option>
                                   <option value="ATPNRW">ATPNRW</option>
                                   <option value="ATRW">ATRW</option>
                                   <option value="ICP-IEC">ICP-IEC</option>
                                   <option value="ICP-UL">ICP-UL</option>
                                   <option value="SSW7000">SSW7000</option>
                                   <option value="TDW01">TDW01</option>
                                   <option value="TDW02">TDW02</option>
                                   <option value="PLC">PLC</option>
                                   <option value="BCFW">BCFW</option>
                                   <option value="CCMX02">CCMX02</option>`;
            divOpcion.appendChild(opcion);
            formFieldsContainer.appendChild(divOpcion);
  
            // Campo de idColumna
            const divIdColumna = document.createElement('div');
            divIdColumna.classList.add('form-field');
  
            const labelIdColumna = document.createElement('h6');
            labelIdColumna.textContent = `Columnas:`;
            divIdColumna.appendChild(labelIdColumna);
  
            const idColumna = document.createElement('input');
            idColumna.type = 'number';
            idColumna.id = `idColumna-${i}`;
            idColumna.name = `columna-id-${i}`;
            idColumna.min = '1';
            idColumna.max = '100';
            idColumna.placeholder = "No. Columnas";
            idColumna.style.display = 'none';
            labelIdColumna.style.display = 'none';
            divIdColumna.appendChild(idColumna);
            formFieldsContainer.appendChild(divIdColumna);
  
            // Campo de idItem
            const divIdItem = document.createElement('div');
            divIdItem.classList.add('form-field');
  
            const labelIdItem = document.createElement('h6');
            labelIdItem.textContent = `Item:`;
            divIdItem.appendChild(labelIdItem);
  
            const idItem = document.createElement('input');
            idItem.type = 'number';
            idItem.id = `idItem-${i}`;
            idItem.name = `item-id-${i}`;
            idItem.min = '1';
            idItem.max = '1000000000';
            idItem.placeholder = "Item: 17289190";
            divIdItem.appendChild(idItem);
            formFieldsContainer.appendChild(divIdItem);
  
            // Campo de difficulty
            const divDifficulty = document.createElement('div');
            divDifficulty.classList.add('form-field');
  
            const labelDifficulty = document.createElement('h6');
            labelDifficulty.textContent = `Dificultad:`;
            divDifficulty.appendChild(labelDifficulty);
  
            const difficulty = document.createElement('select');
            difficulty.name = `item-difficulty-${i}`;
            difficulty.id = `difficulty-${i}`;
            difficulty.innerHTML = `<option value="Baja">Baja</option>
                                   <option value="Media">Media</option>
                                   <option value="Alta">Alta</option>`;
            divDifficulty.appendChild(difficulty);
            formFieldsContainer.appendChild(divDifficulty);

            // Campo del numero de semanas
            const sem = document.createElement('div');
            sem.classList.add('form-field');
  
            const labelsem = document.createElement('h6');
            labelsem.textContent = `N. Semanas:`;
            sem.appendChild(labelsem);
  
            const sema = document.createElement('input');
            sema.type = 'number';
            sema.id = `idsem-${i}`;
            sema.name = `sem-id-${i}`;
            sema.min = '1';
            sema.max = '1000000000';
            sema.placeholder = "28 semanas";
            sem.appendChild(sema);
            formFieldsContainer.appendChild(sem);
  
            // Campo de fecha inicial
            const divDate = document.createElement('div');
            divDate.classList.add('form-field');

            const labelDate = document.createElement('h6');
            labelDate.textContent = `Inicial:`;
            divDate.appendChild(labelDate);

            const date = document.createElement('input');
            date.type = 'date';
            date.id = `date-${i}`;
            date.name = `item-start-date-${i}`;

            // Establecer la fecha actual como valor por defecto
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Establecer la hora a medianoche para evitar problemas de zona horaria
            const todayISO = today.toISOString().split('T')[0];
            date.value = todayISO;
            date.defaultValue = todayISO;

            divDate.appendChild(date);
            formFieldsContainer.appendChild(divDate);

            /* Tamaño 
            Campo de fecha inicial
            const divDate = document.createElement('div');
            divDate.classList.add('form-field');

            const labelDate = document.createElement('h6');
            labelDate.textContent = `Inicial:`;
            divDate.appendChild(labelDate);

            const date = document.createElement('input');
            date.type = 'date';
            date.id = `date-${i}`;
            date.name = `item-start-date-${i}`;

            // Establecer la fecha actual como valor por defecto
            const today = new Date().toISOString().split('T')[0];
            date.value = today;
            date.defaultValue = today;

            divDate.appendChild(date);
            formFieldsContainer.appendChild(divDate);
            */

            // Campo de fecha final
            const divDateF = document.createElement('div');
            divDateF.classList.add('form-field');

            const labelDateF = document.createElement('h6');
            labelDateF.textContent = `Final/Ofertado:`;
            divDateF.appendChild(labelDateF);

            const dateF = document.createElement('input');
            dateF.type = 'date';
            dateF.id = `dateF-${i}`;
            dateF.name = `item-start-dateF-${i}`;
            divDateF.appendChild(dateF);
            formFieldsContainer.appendChild(divDateF);

            // Función para calcular la fecha final
            const calculateEndDate = () => {
            const startDateValue = date.value;
            const weeks = parseInt(sema.value);

            if (startDateValue && weeks > 0) {
                const startDate = new Date(startDateValue);
                const endDate = new Date(startDate);

                endDate.setDate(startDate.getDate() + weeks * 7);

                // Ajustar al viernes más cercano
                endDate.setDate(endDate.getDate() + (4 - endDate.getDay()));
                
                dateF.value = endDate.toISOString().split('T')[0];
            } else {
                dateF.value = '';
            }
            };

            // Agregar eventos para calcular la fecha final cuando cambien la fecha inicial o el número de semanas
            date.addEventListener('change', calculateEndDate);
            sema.addEventListener('input', calculateEndDate);
  
            // Mensaje de advertencia
            const warningMessage = document.createElement('h6');
            warningMessage.id = `warning-${i}`;
            warningMessage.style.color = 'red';
            formFieldsContainer.appendChild(warningMessage);
  
            section.appendChild(formFieldsContainer);
            container.appendChild(section);
  
            // Ocultar o mostrar - COLUMNAS AND LABEL BRO.
            opcion.addEventListener('change', function() {
                if (opcion.value === 'CCMX02' || opcion.value === 'ICP-IEC' || opcion.value === 'ICP-UL' || opcion.value === 'TDW02') {
                    idColumna.style.display = 'block';
                    labelIdColumna.style.display = 'block';
                } else {
                    idColumna.style.display = 'none';
                    labelIdColumna.style.display = 'none';
                }
            });
  
            /*  dateF.addEventListener('change', function() {
                const startDateValue = new Date(date.value);
                let endDateValue = new Date(date.value);
  
                // Duraciones de las subtareas en días
                //const taskDurations = [1, 3, 5];
                const taskDurations = [ 1, 3, 5, 2, 3, 3, 6, 2, 4, 4, 1, 2, 1, 1, 3];
                //TENGO QUE HACER QUE MEJOR CUENTE 41 DESDE LA FECHA INICIAL HASTA ADELANTE...
  
                // Calcular la fecha final basada en las duraciones
                for (let duration of taskDurations) {
                    endDateValue.setDate(endDateValue.getDate() + duration);
                }
                
                // Restar 1 día a la fecha final calculada
                endDateValue.setDate(endDateValue.getDate() - 1);
  
                //endDateValue = Es la fecha final calculada
  
                const enteredEndDate = new Date(dateF.value);
  
                //enteredEndDate = Es la fecha final del formulario
  
                if (enteredEndDate < endDateValue) {
                    warningMessage.textContent = 'Correcto';
                } else {
                    warningMessage.textContent = 'Rebasa 41 dias';
                }
            }); */
        }
    }
</script>
<script>
    document.addEventListener("click", function(event) {
        if (event.target.classList.contains("project-button")) {
            const projectButton = event.target;
            const clientName = projectButton.textContent.trim();
            if (confirm(`¿Seguro que quieres eliminar el proyecto "${clientName}"?`)) {
                const projectWrapper = projectButton.parentNode.parentNode;
                projectWrapper.remove();
                deleteProject(clientName);
            }
        }
    });

    function deleteProject(clientName) {
        let projects = JSON.parse(localStorage.getItem("projects")) || [];
        projects = projects.filter(project => project.clientName !== clientName);
        localStorage.setItem("projects", JSON.stringify(projects));
    }
</script>
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="modalContent"></div>
    </div>
</div>
<script src="GanttCopia.js"></script>
</body>
</html>
